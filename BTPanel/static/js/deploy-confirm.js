import{c as e,s as a,r as t,x as s,y as l,e as r,C as i,z as o,R as u,D as n,J as d,F as m,b1 as c,O as p,A as f,B as v,K as _,S as b,G as y,ak as j,aj as h,ad as g,am as x,an as S,ab as k}from"./base-lib.js?v=1764656280";import{u as C}from"./useController5.js?v=1764656280";import{v as w}from"./ssl.js?v=1764656280";import{setSslInfo as L}from"./site.js?v=1764656280";import{Q as N,b as R,_ as V}from"./utils-lib.js?v=1764656280";import{a7 as B,a8 as D,a9 as I,aa as z}from"./useController15.js?v=1764656280";import{u as q}from"./useStore4.js?v=1764656280";import{S as A,u as E}from"./useStore12.js?v=1764656280";import"./__commonjsHelpers__.js?v=1764656280";import"./column.js?v=1764656280";import"./index111.js?v=1764656280";import"./useController6.js?v=1764656280";import"./validator.js?v=1764656280";import"./index108.js?v=1764656280";import"./useMethod5.js?v=1764656280";import"./index110.js?v=1764656280";import"./useController4.js?v=1764656280";const O={class:"p-[16px]"},T={style:{float:"left"}},U={key:0,class:"leading-[2.4rem] text-base ml-[10rem] mt-4"},F=V(e({__name:"deploy-confirm",props:{compData:{default:{oid:"",title:"",domainName:[],cert_type:"",key:"",csr:"",index:"",siteName:""}}},setup(e,{expose:V}){const{siteInfo:F,siteType:G,isRefreshList:H}=q(),{isRefreshLocalList:J}=a(C()),{setBusSslDeployEvent:K}=A(),{isRefreshSSL:M,isRefreshBtSSL:Q,isRefreshLetSSL:P,jumpSslTabEvent:W}=E(),X=e,{oid:Y,domainName:Z,title:$,cert_type:ee,key:ae,csr:te,index:se,siteName:le}=X.compData,re="bt"==ee||"business"==ee,ie=R(),oe=t({target_id:""}),ue=t("direct"),ne=async e=>{ue.value=e,Object.keys(de.value).length||"third"===e&&await N({loading:"正在获取第三方部署列表，请稍后...",request:w({p:1,limit:-1}),data:{data:Array,status:[Boolean,"data.length"]},success:e=>{de.value=e.data}})},de=t([]),me=async()=>{let e;try{e=ie.load("正在部署证书,请稍后...");const a=F.value.name,t={default:{type:G.value,siteName:a,key:ae,csr:te}},s=await N({loading:"正在部署证书，请稍后...",request:L(t[G.value]||t.default,G.value),message:!0});return pe[ee](),s.status&&W("currentCertInfo"),s.status}catch(a){return!1}finally{e&&e.close()}},ce=async()=>{let e;try{e=ie.load("正在部署证书,请稍后...");const a=F.value.name,t=G.value,s={proxy:{oid:Y,site_name:a},docker:{oid:Y,site_name:a},default:{oid:Y,siteName:a}},l=await K(s[t]||s.default);return pe[ee](),l.status&&W("currentCertInfo"),l.status}catch(a){return!1}finally{e&&e.close()}},pe={business:()=>ve(),bt:()=>_e(),le:()=>fe()},fe=()=>{I(),H.value=!0,M.value=!0,P.value=!0,J.value=!0},ve=()=>{z(),I(),M.value=!0,H.value=!0,J.value=!0},_e=()=>{I(),H.value=!0,M.value=!0,Q.value=!0,J.value=!0};return V({onConfirm:async e=>{if("third"!==ue.value||oe.value.target_id){if("direct"!==ue.value){let e={};switch(ee){case"business":default:e={oid:Y};break;case"bt":e={key:ae,cert:te};break;case"le":e={index:se}}const a=await D({...e,target_id:oe.value.target_id},pe[ee]);return ie[a.status?"success":"error"](a.msg),a.status}switch(ee){case"business":default:return ce();case"bt":return me();case"le":return B({index:se},!0,F.value.name)}}else ie.error("请选择部署目标")}}),(e,a)=>{const t=j,C=h,w=g,L=x,N=S,R=k;return s(),l("div",O,[r(R,{model:o(oe),class:"relative w-full","label-position":"right",size:"small",onSubmit:a[2]||(a[2]=b(()=>{},["prevent"]))},{default:i(()=>[r(w,{label:"部署类型",prop:"deploy_type"},{default:i(()=>[r(C,{modelValue:o(ue),"onUpdate:modelValue":a[0]||(a[0]=e=>u(ue)?ue.value=e:null),onChange:ne},{default:i(()=>[r(t,{value:"direct"},{default:i(()=>[...a[3]||(a[3]=[n("直接部署",-1)])]),_:1}),r(t,{value:"third"},{default:i(()=>[...a[4]||(a[4]=[n("第三方部署",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),d(r(w,{label:"部署目标",prop:"target_id"},{default:i(()=>[r(N,{modelValue:o(oe).target_id,"onUpdate:modelValue":a[1]||(a[1]=e=>o(oe).target_id=e),class:"!w-[33rem]",filterable:"","default-first-option":"",size:"default",placeholder:"请选择部署目标"},{default:i(()=>[(s(!0),l(m,null,c(o(de),e=>(s(),p(L,{key:e.id,label:"".concat(e.name," - ").concat(e.description),value:e.id},{default:i(()=>[f("span",T,v("".concat(e.name," - ").concat(e.description)),1)]),_:2},1032,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1},512),[[_,"third"===o(ue)]])]),_:1},8,["model"]),"direct"===o(ue)&&o(re)?(s(),l("div",U,[n(" 证书类型："+v(o($)),1),a[5]||(a[5]=f("br",null,null,-1)),n(" 证书支持域名："+v(o(Z).join("、")),1),a[6]||(a[6]=f("br",null,null,-1)),n(" 部署站点名："+v(o(F).name),1)])):y("",!0)])}}}),[["__scopeId","data-v-512ae385"]]);export{F as default};
