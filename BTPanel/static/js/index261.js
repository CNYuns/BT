import{aQ as e,Q as a,cC as l,M as s,ay as o,iW as n,ax as u,aC as r,_ as m}from"./utils-lib.js?v=1764728423";import{r as t,o as d,c,v as i,a8 as f,x as p,y as _,e as v,C as b,z as g,S as y,Q as h,D as x,A as V,R as w,ad as C,H as k,U as j,ab as U,aD as R}from"./base-lib.js?v=1764728423";import{_ as z}from"./index123.js?v=1764728423";import"./__commonjsHelpers__.js?v=1764728423";const{refs:{isRefreshTableList:Q}}=e();let S=null;const T=t(!1),q=t(""),A=t("common"),D=d({name:"",image:"",cmd:""}),E={model_index:"btdocker",mod_name:"image",def_name:"pull_from_some_registry",ws_callback:111,name:"",image:""},H=()=>{q.value=""},K=(e,a)=>{try{const e=a.data;if(q.value+="".concat(e),e.includes("bt_successful")||e.includes("bt_failed")){const a={status:e.includes("bt_successful"),msg:e.includes("bt_successful")?"拉取成功":"拉取失败"};s.request(a),a.status&&(Q.value=!0),null==S||S.close(),T.value=!1}}catch(l){}},M=()=>{null==S||S.close(),q.value="",S=o({route:"/ws_model",onMessage:K}),null==S||S.send(E)},F={image:[{validator:(e,a,l)=>{""===a?l(new Error("请输入镜像名")):l()},trigger:["blur"]}]},I=()=>{Q.value=!0},L=t([]),W=async e=>{try{if("cmd"===A.value)return void(async()=>{try{if(""===D.cmd)return void s.error("请输入命令");T.value=!0,E.name="",E.url="",E.image="",E.def_name="get_cmd_log";const e=await n({cmd:D.cmd},"image");e.status?M():(s.error(e.msg),T.value=!1)}catch(e){}})();if(""===D.name)return void s.error("请选择仓库名");T.value=!0,await e.value.validate(async e=>{e?(E.name=L.value.find(e=>e.url==D.name).name,E.url=L.value.find(e=>e.url==D.name).url,E.image=D.image,E.def_name="pull_from_some_registry",M()):T.value=!1})}catch(a){}},B={class:"flex flex-col p-[1.6rem] lib-box"},G={class:"rounded-small h-[45.6rem]"},J={class:"rounded-small h-[45.6rem]"},N=m(c({__name:"index",setup(e,{expose:s}){const o=t(),n=()=>{W(o)};return i(()=>{(async()=>{a({request:l(),data:Array,success:e=>{var a;e.forEach(e=>{L.value.push({value:e.url,label:"".concat(e.name).concat("docker.io"===e.url?"":"(".concat(e.url,")")),url:e.url,name:e.name})}),D.name=null==(a=L.value[0])?void 0:a.value}})})()}),f(()=>{null==S||S.close(),S=null,L.value=[],D.name="",D.image="",D.cmd="",H()}),s({onConfirm:n,onCancel:I}),(e,a)=>{const l=u,s=C,m=k,t=j,d=z,c=U,i=R,f=r;return p(),_("div",B,[v(f,{modelValue:g(A),"onUpdate:modelValue":a[5]||(a[5]=e=>w(A)?A.value=e:null),type:"card",onChange:g(H)},{default:b(()=>[v(i,{name:"common",label:"常规拉取"},{default:b(()=>[v(c,{ref_key:"cmdFormRef",ref:o,size:"default",model:g(D),rules:g(F),disabled:g(T),class:"relative w-full","label-position":"right",onSubmit:a[2]||(a[2]=y(()=>{},["prevent"]))},{default:b(()=>[v(s,{prop:"name",label:"仓库名"},{default:b(()=>[v(l,{modelValue:g(D).name,"onUpdate:modelValue":a[0]||(a[0]=e=>g(D).name=e),options:g(L),class:"!w-[32rem]"},null,8,["modelValue","options"])]),_:1}),v(s,{prop:"image",label:"镜像名"},{default:b(()=>[v(t,{class:"!w-[32rem]",modelValue:g(D).image,"onUpdate:modelValue":a[1]||(a[1]=e=>g(D).image=e),onKeydown:h(n,["enter"]),placeholder:"请输入镜像名，按回车拉取,如:image:v1"},{append:b(()=>[v(m,{type:"default",onClick:n},{default:b(()=>[...a[6]||(a[6]=[x("拉取",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a[7]||(a[7]=V("div",{class:"resultTitle px-[.2rem] py-[.4rem] mt-[1.6rem]"},"拉取结果：",-1)),V("div",G,[v(d,{class:"h-[45.6rem] !rounded-none",content:g(q)},null,8,["content"])])]),_:1},8,["model","rules","disabled"])]),_:1}),v(i,{name:"cmd",label:"命令拉取"},{default:b(()=>[v(c,{ref:"cmdRef",size:"large",model:g(D),rules:g(F),disabled:g(T),class:"relative w-full","label-position":"right",onSubmit:a[4]||(a[4]=y(()=>{},["prevent"]))},{default:b(()=>[v(s,{prop:"cmd"},{default:b(()=>[v(t,{autofocus:"",modelValue:g(D).cmd,"onUpdate:modelValue":a[3]||(a[3]=e=>g(D).cmd=e),onKeyup:h(n,["enter"]),placeholder:"请输入需要执行的命令,docker pull redis:latest，按回车执行"},{append:b(()=>[v(m,{type:"default",onClick:n},{default:b(()=>[...a[8]||(a[8]=[x("执行命令",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1}),a[9]||(a[9]=V("div",{class:"resultTitle px-[.2rem] py-[.4rem] mt-[1.6rem]"},"拉取结果：",-1)),V("div",J,[v(d,{class:"h-[45.6rem] !rounded-none",content:g(q)},null,8,["content"])])]),_:1},8,["model","rules","disabled"])]),_:1})]),_:1},8,["modelValue","onChange"])])}}}),[["__scopeId","data-v-e3d09b27"]]);export{N as default};
