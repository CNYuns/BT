import{bo as e,e as a,H as t}from"./utils-lib.js?v=1764728423";import{_ as l}from"./index110.js?v=1764728423";import{r as i,k as r,g as o,w as u,v as n,n as s,a8 as c,aP as v,x as d,y as f,A as p,F as y,b1 as m,e as _,C as x,D as w,z as b,R as h,G as g,bM as k,al as D,aj as j,B as V}from"./base-lib.js?v=1764728423";import{_ as S}from"./index111.js?v=1764728423";import{l as T}from"./validator.js?v=1764728423";import{getOverviewTop5 as q,getSiteOverviewTop5 as P}from"./site.js?v=1764728423";import"./__commonjsHelpers__.js?v=1764728423";import"./column.js?v=1764728423";import"./index107.js?v=1764728423";const z={class:"px-16 py-8 relative"},A={class:"flex flex-col pb-12"},B={class:"flex"},L={class:"text-secondary text-[12px]"},C={class:"flex items-center gap-2 mt-0.5"},M={class:"text-[18px] font-bold text-darkPrimary"},O={class:"text-[12px] text-secondary mt-0.5"},U={class:"text-[12px] text-tertiary mt-0.5"},E={key:0,class:"flex flex-col pb-12"},I={class:"mb-1"},N={class:"flex flex-col"},R={class:"mb-1"},F={class:"flex items-center"},G={class:"flex items-center"},H={__name:"index",props:{compData:{type:Object,default:()=>({viewType:"all",siteName:""})},visibleMetrics:{type:Array,default:()=>["traffic","req_count","ip_count","uv","pv"]}},setup(H){const K=H,W=i(null),J=i(null),Q=i(!1),X=i(null);i("点击领取七天试用");const Y=r("siteStatisticsMetric","traffic"),Z=r("siteStatisticsCenterMetric","traffic"),$=r("siteStatisticsSortOrder","desc"),ee=i(null);let ae=null;const te=i(null);let le=null;const ie=async e=>{Q.value=!0,X.value=null;try{return(await q(e)).data.data}catch(a){return X.value=a,null}finally{Q.value=!1}},re=e=>{var a,t,l,i,r,o,u,n,s,c,v,d,f,p,y;if(!e)return{today:{},yesterday:{},dayBefore:{}};const{overview_three_days:m}=e;return{today:{traffic:(null==(a=null==m?void 0:m.today)?void 0:a.traffic_bytes)||0,req_count:(null==(t=null==m?void 0:m.today)?void 0:t.req_count)||0,ip_count:(null==(l=null==m?void 0:m.today)?void 0:l.ip_count)||0,uv:(null==(i=null==m?void 0:m.today)?void 0:i.uv)||0,pv:(null==(r=null==m?void 0:m.today)?void 0:r.pv)||0},yesterday:{traffic:(null==(o=null==m?void 0:m.yesterday)?void 0:o.traffic_bytes)||0,req_count:(null==(u=null==m?void 0:m.yesterday)?void 0:u.req_count)||0,ip_count:(null==(n=null==m?void 0:m.yesterday)?void 0:n.ip_count)||0,uv:(null==(s=null==m?void 0:m.yesterday)?void 0:s.uv)||0,pv:(null==(c=null==m?void 0:m.yesterday)?void 0:c.pv)||0},dayBefore:{traffic:(null==(v=null==m?void 0:m.day_before)?void 0:v.traffic_bytes)||0,req_count:(null==(d=null==m?void 0:m.day_before)?void 0:d.req_count)||0,ip_count:(null==(f=null==m?void 0:m.day_before)?void 0:f.ip_count)||0,uv:(null==(p=null==m?void 0:m.day_before)?void 0:p.uv)||0,pv:(null==(y=null==m?void 0:m.day_before)?void 0:y.pv)||0}}},oe=e=>{var a;return(null==(a=null==e?void 0:e.trend_7days)?void 0:a.points)?e.trend_7days.points.map(e=>({date:e.date,traffic:e.traffic_bytes,req_count:e.req_count,ip_count:e.ip_count,uv:e.uv,pv:e.pv})):[]},ue=o(()=>W.value?re(W.value):null),ne=o(()=>J.value?re(J.value):null),se=o(()=>{var e,a;return"all"===K.compData.viewType?(null==(e=ue.value)?void 0:e.today)||{}:(null==(a=ne.value)?void 0:a.today)||{}}),ce=o(()=>{var e,a;return"all"===K.compData.viewType?(null==(e=ue.value)?void 0:e.yesterday)||{}:(null==(a=ne.value)?void 0:a.yesterday)||{}}),ve=o(()=>{var e,a;return"all"===K.compData.viewType?(null==(e=ue.value)?void 0:e.dayBefore)||{}:(null==(a=ne.value)?void 0:a.dayBefore)||{}}),de=o(()=>{return"all"!==K.compData.viewType?[]:(e=W.value,(null==(a=null==e?void 0:e.top5_sites)?void 0:a.items)?e.top5_sites.items.map(e=>({name:e.site,traffic:e.traffic_bytes,req_count:e.req_count,ip_count:e.ip_count,uv:e.uv,pv:e.pv})):[]);var e,a}),fe=o(()=>"all"===K.compData.viewType?oe(W.value):oe(J.value)),pe=async()=>{const a=e("正在获取网站概览数据，请稍后...");try{"all"===K.compData.viewType?W.value=await ie({metric:Y.value,order:$.value}):J.value=await(async e=>{Q.value=!0,X.value=null;try{return(await P(e)).data.data}catch(a){return X.value=a,null}finally{Q.value=!1}})({site_name:K.compData.siteName}),await s(),await _e(),await xe()}finally{a.close()}};u([K.compData.viewType,K.compData.siteName],async()=>{await pe()},{immediate:!0}),u([Y,$],async()=>{"all"===K.compData.viewType&&(W.value=await ie({metric:Y.value,order:$.value}),await s(),await _e())}),u([Z,fe],async()=>{await s(),await xe()});const ye=e=>"traffic"===Y.value?be(e):e,me={ip_count:"IP",uv:"UV",pv:"PV",req_count:"请求数",traffic:"流量"},_e=async()=>{if("all"!==K.compData.viewType)return;if(await(async()=>{if(!ae&&ee.value){const e=await t(()=>import("./index305.js?v=1764728423"),__vite__mapDeps([]),import.meta.url);ae=e.init(ee.value)}})(),!ae)return;const e=(()=>{if("all"!==K.compData.viewType)return{};const e=de.value.map(e=>({name:e.name,value:e[Y.value]}));e.sort((e,a)=>"desc"===$.value?e.value-a.value:a.value-e.value);const a=e.map(e=>e.name),t=e.map(e=>e.value);return{grid:{left:140,right:45,top:36,bottom:36},tooltip:{trigger:"axis",axisPointer:{type:"shadow"},formatter:e=>{const a=Array.isArray(e)?e[0]:e,t=a.value,l="traffic"===Y.value?be(t):t;return"".concat(a.name,"<br/>").concat(a.seriesName,": ").concat(l)}},xAxis:{type:"value",axisLabel:{formatter:ye,color:"#666",fontSize:11}},yAxis:{type:"category",data:a,axisLabel:{color:"#666",fontSize:12}},series:[{name:me[Y.value],type:"bar",data:t,barWidth:14,itemStyle:{color:"#18a058"},label:{show:!0,position:"right",color:"#333",fontSize:12,formatter:e=>"traffic"===Y.value?be(e.value):e.value}}]}})();ae.setOption(e,!0)},xe=async()=>{if(await(async()=>{if(!le&&te.value){const e=await t(()=>import("./index305.js?v=1764728423"),__vite__mapDeps([]),import.meta.url);le=e.init(te.value)}})(),!le)return;const e=(()=>{var e;if(!(null==(e=fe.value)?void 0:e.length))return{xAxis:{data:[]},series:[]};const a=Z.value,t=me[a],l=[...fe.value].sort((e,a)=>new Date(e.date).getTime()-new Date(a.date).getTime());return{grid:{left:80,right:45,top:36,bottom:36},tooltip:{trigger:"axis",axisPointer:{type:"line"},formatter:e=>{const t=Array.isArray(e)?e[0]:e,l=t.value,i="traffic"===a?be(l):l;return"".concat(t.name,"<br/>").concat(t.seriesName,": ").concat(i)}},xAxis:{type:"category",data:l.map(e=>he(e.date)),axisLabel:{color:"#666",fontSize:12}},yAxis:{type:"value",axisLabel:{formatter:e=>"traffic"===a?be(e):e,color:"#666",fontSize:11}},series:[{name:t,type:"line",data:l.map(e=>e[a]),smooth:!0,areaStyle:{opacity:.1},itemStyle:{color:"#18a058"},lineStyle:{color:"#18a058",width:2},label:{show:!0,position:"top",color:"#333",fontSize:10,formatter:e=>"traffic"===a?be(e.value):e.value}}]}})();le.setOption(e,!0)},we=()=>{ae&&ae.resize(),le&&le.resize()};n(async()=>{await s(),await _e(),await xe(),window.addEventListener("resize",we)}),c(()=>{if(window.removeEventListener("resize",we),ae){try{ae.dispose()}catch(e){}ae=null}if(le){try{le.dispose()}catch(e){}le=null}});const be=e=>{if(0===e)return"0 B";if(e<1024)return e+" B";const a=["KB","MB","GB","TB"];let t=-1;do{e/=1024,t++}while(e>=1024&&t<a.length-1);return"".concat(e.toFixed(2)," ").concat(a[t])},he=e=>{if(!e)return"";const a=new Date(e),t=String(a.getMonth()+1).padStart(2,"0"),l=String(a.getDate()).padStart(2,"0");return"".concat(t,"-").concat(l)},ge=[{key:"traffic",label:"流量",format:be},{key:"req_count",label:"请求数"},{key:"ip_count",label:"IP"},{key:"uv",label:"UV"},{key:"pv",label:"PV"}],ke=o(()=>ge.filter(e=>K.visibleMetrics.includes(e.key)));return(e,t)=>{const i=k,r=a,o=S,u=D,n=j,s=l,c=v("n-text"),q=a;return d(),f("div",z,[p("div",A,[p("div",B,[(d(!0),f(y,null,m(ke.value,e=>(d(),f("div",{key:e.key,class:"text-left flex flex-col pl-[1rem] flex-1 gap-[0.2rem]"},[p("div",L,[_(i,{size:6},{default:x(()=>[t[4]||(t[4]=p("span",{class:"w-4 h-4 bg-primaryDark rounded-full inline-block"},null,-1)),p("span",null,V(e.label),1)]),_:2},1024)]),p("div",C,[p("div",M,V(e.format?e.format(se.value[e.key]):se.value[e.key]),1)]),p("div",O,"昨日 "+V(e.format?e.format(ce.value[e.key]):ce.value[e.key]),1),p("div",U,"前日 "+V(e.format?e.format(ve.value[e.key]):ve.value[e.key]),1)]))),128)),p("div",{class:"text-left flex flex-col items-center cursor-pointer pr-[1rem]",onClick:pe},[_(r,{href:"javascript:;",class:"flex items-center justify-center"},{default:x(()=>[...t[5]||(t[5]=[p("i",{title:"",class:"svgtofont-icon-refresh !text-[1.8rem] flex items-center justify-center mr-[0.5rem]"},null,-1),w("刷新",-1)])]),_:1}),_(o,{name:"tools-logo",class:"opacity-90",size:"40"})])])]),"all"===H.compData.viewType?(d(),f("div",E,[p("div",I,[_(i,{class:"w-full flex justify-between"},{default:x(()=>[t[13]||(t[13]=p("strong",{class:"text-[1.6rem] font-bold"},"今日网站排名TOP5",-1)),_(i,null,{default:x(()=>[_(n,{modelValue:b($),"onUpdate:modelValue":t[0]||(t[0]=e=>h($)?$.value=e:null)},{default:x(()=>[_(u,{value:"desc"},{default:x(()=>[...t[6]||(t[6]=[w("降序",-1)])]),_:1}),_(u,{value:"asc"},{default:x(()=>[...t[7]||(t[7]=[w("升序",-1)])]),_:1})]),_:1},8,["modelValue"]),_(n,{modelValue:b(Y),"onUpdate:modelValue":t[1]||(t[1]=e=>h(Y)?Y.value=e:null)},{default:x(()=>[_(u,{value:"traffic"},{default:x(()=>[...t[8]||(t[8]=[w("流量",-1)])]),_:1}),_(u,{value:"req_count"},{default:x(()=>[...t[9]||(t[9]=[w("请求数",-1)])]),_:1}),_(u,{value:"ip_count"},{default:x(()=>[...t[10]||(t[10]=[w("IP",-1)])]),_:1}),_(u,{value:"uv"},{default:x(()=>[...t[11]||(t[11]=[w("UV",-1)])]),_:1}),_(u,{value:"pv"},{default:x(()=>[...t[12]||(t[12]=[w("PV",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),p("div",{ref_key:"rankingChartRef",ref:ee,class:"h-[180px]"},null,512)])):g("",!0),p("div",N,[p("div",R,[_(i,{class:"w-full flex justify-between"},{default:x(()=>[t[19]||(t[19]=p("strong",{class:"text-[1.6rem] font-bold"},"近7天统计数据",-1)),_(i,null,{default:x(()=>[_(n,{modelValue:b(Z),"onUpdate:modelValue":t[2]||(t[2]=e=>h(Z)?Z.value=e:null)},{default:x(()=>[_(u,{value:"traffic"},{default:x(()=>[...t[14]||(t[14]=[w("流量",-1)])]),_:1}),_(u,{value:"req_count"},{default:x(()=>[...t[15]||(t[15]=[w("请求数",-1)])]),_:1}),_(u,{value:"ip_count"},{default:x(()=>[...t[16]||(t[16]=[w("IP",-1)])]),_:1}),_(u,{value:"uv"},{default:x(()=>[...t[17]||(t[17]=[w("UV",-1)])]),_:1}),_(u,{value:"pv"},{default:x(()=>[...t[18]||(t[18]=[w("PV",-1)])]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),p("div",{ref_key:"statsCenterChartRef",ref:te,class:"h-[220px]"},null,512)]),_(s,{direction:"horizontal",class:"!my-6"}),p("div",F,[_(c,{depth:"3"},{default:x(()=>[...t[20]||(t[20]=[w(" 此为简易网站数据统计，如需更详细的数据详情，请使用",-1)])]),_:1}),_(q,{href:"javascript:;",onClick:t[3]||(t[3]=e=>b(T)({name:"monitor",installNow:!0,source:363}))},{default:x(()=>[...t[21]||(t[21]=[w("网站监控报表",-1)])]),_:1})]),p("div",G,[_(c,{depth:"3"},{default:x(()=>[...t[22]||(t[22]=[w("立即查看网站监控报表的全部能力",-1)])]),_:1}),_(q,{href:"https://www.bt.cn/new/product_website_total.html"},{default:x(()=>[...t[23]||(t[23]=[w(">>点我跳转",-1)])]),_:1})])])}}};export{H as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
