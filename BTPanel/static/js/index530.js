import{an as e,aA as a,V as t,p as s,Q as l,j as o}from"./utils-lib.js?v=1764656280";import{_ as i}from"./index124.js?v=1764656280";import{_ as r}from"./index110.js?v=1764656280";import{c as n,r as m,e as d,be as c,D as u,aT as p,x as h,y as _,C as v,z as f,A as g,R as b,F as x}from"./base-lib.js?v=1764656280";import{getRecordsList as w,rollback as j}from"./site.js?v=1764656280";import{u as y}from"./column.js?v=1764656280";import{u as k}from"./useStore4.js?v=1764656280";import"./__commonjsHelpers__.js?v=1764656280";import"./index111.js?v=1764656280";const B={class:"p-20px"},C=n({__name:"index",setup(n,{expose:C}){const{siteInfo:T}=k(),V=m(!1),q=m(!1),A=m({}),{BtTable:O,BtSearch:R,BtRefresh:S,BtPage:z,param:D,refresh:F}=e({request:async e=>{const t=await w({git_manager_id:T.value.git_manager.id,p:e.p,limit:e.limit});return{data:t.data.data,total:a(t.data.page)}},columns:[{label:"提交",prop:"commit",render:(e,a)=>d(p,{effect:"dark",content:e.commit_hash,placement:"top"},{default:()=>[d("div",{class:"flex items-center gap-10px"},[d("div",{class:"flex flex-col"},[d("div",{class:"text-default"},[e.commit_hash.slice(0,7)]),d("div",{class:"text-tertiary"},[e.commit_author])]),a||1!==D.value.p?null:d(c,{type:"success"},{default:()=>[u("激活")]})])]})},{label:"分支",prop:"branch",showOverflowTooltip:!0,width:80},{label:"提交信息",prop:"commit_message",showOverflowTooltip:!0,render:e=>d("div",{class:"bt-link truncate",onClick:()=>{A.value=e,q.value=!0}},[e.commit_message])},{label:"状态",prop:"status",width:60,render:e=>d("span",{onClick:()=>{A.value=e,q.value=!0},class:e.status?"bt-link":"bt-danger"},[e.status?"成功":"失败"])},{label:"部署类型",prop:"deploy_mode",width:64,render:e=>1===e.deploy_mode?"自动部署":"手动部署"},{label:"部署时间",prop:"deployment_time",width:150,render:e=>d("div",null,[d("div",{class:"text-default"},[t(e.deploy_time)]),d("div",{class:"text-tertiary"},[u("耗时："),e.duration,u("s")])])},y([{render:(e,a)=>d("span",{class:a||1!==D.value.p?"bt-link":"cursor-not-allowed",onClick:()=>(async(e,a)=>{(a||1!==D.value.p)&&(await s({width:"51rem",title:"回滚确认",content:()=>d("div",null,[u("您将把部署回滚到较早的提交状态，"),d("span",{class:"text-warning"},[u("请先备份站点文件以避免数据丢失！")])])}),l({loading:"正在回滚记录，请稍后...",request:j({branch:e.branch,git_manager_id:T.value.git_manager.id,commit:e.commit_hash}),message:!0,success:()=>{F()}}))})(e,a)},[u("回滚")])}])]});return C({init:F}),(e,a)=>{var t,s;const l=r,n=i,m=o;return h(),_(x,null,[d(l,null,{"header-right":v(()=>[d(f(S))]),content:v(()=>[d(f(O),{"max-height":460})]),"footer-right":v(()=>[d(f(z))]),_:1}),d(m,{title:"日志[".concat(null==(s=null==(t=f(A))?void 0:t.commit_hash)?void 0:s.slice(0,7),"]"),modelValue:f(q),"onUpdate:modelValue":a[0]||(a[0]=e=>b(q)?q.value=e:null),area:[53]},{default:v(()=>{var e;return[g("div",B,[d(n,{loading:f(V),class:"!h-[38rem]",content:null==(e=f(A))?void 0:e.log_content},null,8,["loading","content"])])]}),_:1},8,["title","modelValue"])],64)}}});export{C as default};
