import{B as e,Q as t,ch as a,a_ as s,am as l,n,H as r,M as i,ak as o,p as c,ck as u,e as d,f as p,_ as m,hA as v,hz as f,ao as h,$ as y,R as g,f2 as w,f3 as _,ag as b,j as x,bJ as S,r as k,l as C,u as A,b as T,an as E,az as L}from"./utils-lib.js?v=1764728423";import{editAgainVerify as N,checkSslMethod as D,applyCertOrderPay as I,applyBusSsl as P,removeCloudCert as O,getDockerDeploySiteDomain as V,getDeploySiteDomain as R,uploadCertToCloud as j,getCertList as H,updateSslTask as q,setSslInfo as B,setProxyHttps as M,setDockerHttps as U,setSiteHttps as F,closeSiteHttps as J,downloadCert as z,ignoreHttpsMode as G,getDockerLetsEncryptSite as K,getLetsEncryptSite as X,applyCertApi as Z,applyProxyCertArrange as Y,getLetsEncryptList as Q,downloadCertToLocal as W,setDockerCertToSite as $,setCertToSite as ee,delLetsEncrypt as te,getOrderDetail as ae,authDomainApi as se,renewalCert as le,validateDomain as ne,getComposerLine as re,getDnsData as ie,setDomainDNS as oe,letCertInitApi as ce,letRenewCert as ue,reissueCertOrder as de,closeCertArrange as pe,batchSetSsl as me,setBatchCertToSite as ve,getDnsApiList as fe,setDnsApiInfo as he}from"./site.js?v=1764728423";import{_ as ye}from"./index109.js?v=1764728423";import{r as ge,e as we,D as _e,aT as be,s as xe,g as Se,o as ke,H as Ce,aA as Ae,c as Te,x as Ee,O as Le,C as Ne,N as De,A as Ie,m as Pe,z as Oe,q as Ve,y as Re,F as je,b1 as He,L as qe,B as Be,n as Me,aE as Ue,I as Fe,R as Je,J as ze,ax as Ge,az as Ke,aB as Xe,v as Ze,G as Ye,aZ as Qe,ap as We,U as $e,am as et,an as tt,a9 as at,t as st}from"./base-lib.js?v=1764728423";import{_ as lt}from"./index110.js?v=1764728423";import{a as nt,u as rt}from"./column.js?v=1764728423";import{u as it,S as ot}from"./useStore12.js?v=1764728423";import{u as ct}from"./useStore4.js?v=1764728423";import{n as ut,o as dt}from"./useController6.js?v=1764728423";import{u as pt,p as mt}from"./useController5.js?v=1764728423";import{h as vt}from"./useController4.js?v=1764728423";import{s as ft,t as ht,n as yt}from"./ssl.js?v=1764728423";import{j as gt,b as wt,aJ as _t,h as bt,i as xt,o as St}from"./validator.js?v=1764728423";const{certVerifyInfo:kt}=it(),{verifyBusCertEvent:Ct}=ot(),At=async e=>{try{const a={oid:kt.value.oid,dcvMethod:e.value.dcvMethod,pid:kt.value.pid,cert_ssl_type:kt.value.certType},s=await t({loading:"正在更改验证方式，请稍后...",request:N(a),message:!0});return(null==s?void 0:s.status)&&Tt(a.oid,a.cert_ssl_type,a.pid),s.status}catch(a){return!1}},Tt=async(e,t,a)=>{const{data:s}=await Ct(e,t,a);s&&_i({...s,cert_ssl_type:t,certType:t,pid:a})},Et=e=>{if("CNAME_CSR_HASH"===Ns.value)return e.url;const t="HTTPS_CSR_HASH"===Ns.value?"https://":"http://";return"".concat(t).concat(e.url,"/.well-known/pki-validation/").concat(e.content)},Lt=ge([{label:"URL",prop:"url",showOverflowTooltip:!0,render:e=>we("span",null,[Et(e)])},{label:"验证结果",prop:"status",width:100,render:e=>we("span",{class:"".concat(e.status?"text-primary":"text-danger")},[e.status?"成功":"失败"])},{label:"自动设置验证值",prop:"verify_status",width:120,isHide:()=>"CNAME_CSR_HASH"!==Ns.value,render:e=>e.verify_status?we("span",{class:"text-primary"},[_e("成功")]):we(be,{placement:"top",content:e.msg,enterable:!1},{default:()=>[we("span",{class:"text-danger"},[_e("失败")])]})},{label:"操作",align:"right",width:160,render:(t,a)=>{const s=[];return"CNAME_CSR_HASH"===Ns.value||s.push(we("span",{class:"cursor-pointer bt-link",onClick:()=>e({value:Et(t)})},[_e("复制")]),we(lt,null,null),we("a",{class:"bt-link",href:Et(t),target:"_blank"},[_e("打开")]),we(lt,null,null)),s.push(we("span",{class:"cursor-pointer bt-link",onClick:()=>ks(t,a)},[_e("重新验证")])),we("div",{class:"flex items-center justify-end"},[s])}}]),{siteInfo:Nt,siteType:Dt,isRefreshList:It}=ct(),{isRefreshLocalList:Pt}=xe(pt()),{orderInfo:Ot,sslApplicationInfo:Vt,certVerifyInfo:Rt,otherPopup:jt,isRefreshSSL:Ht,sslDnsApiInfo:qt}=it(),{buyArtificialServiceEvent:Bt,getCertAdminInfoEvent:Mt,submitCertInfoEvent:Ut,setBusSslDeployEvent:Ft,getSslListEvent:Jt,verifyBusCertEvent:zt,getCertSslListEvent:Gt,getDomainListEvent:Kt,jumpSslTabEvent:Xt}=ot(),Zt=ge(!1),Yt=ge([]),Qt=ge(!1),Wt=ge([{key:"domain",value:"",interface:""}]),$t=["企业级证书","极速申请","防劫持/防篡改","提高SEO权重","赔付保证","不成功可退款","官方推荐(宝塔官网bt.cn也在使用)"],ea=[{content:()=>we("span",{class:"text-danger"},[_e("如果您的站点有使用CDN、高防IP、反向代理、301重定向等功能，可能导致验证失败")])},{content:"证书支持购买多年，只能一年签发一次（有效期一年），需在到期前30天内续签(续签暂不需要验证域名)。"},{content:"申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败。"},{content:"商用证书相对于普通证书，具有更高的安全性、赔付保障和支持通配符和多域名等方式。"}],ta=e=>{let t="text-green";return e.endDate?(e.endDay<=30&&(t="text-orange"),we("span",{class:e.endDay<=10?"text-danger":t},[e.endDay>0?"剩余".concat(e.endDay," 天"):"已过期"])):we("span",null,[_e("--")])},aa=async({oid:e})=>{try{const t=await Bt({pdata:JSON.stringify({oid:e})});Ot.value=t.data,n({isAsync:!0,title:"购买人工服务",area:60,component:()=>r(()=>import("./pay-ssl-service.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),compData:t.data})}catch(t){}},sa=async e=>{const t=await Mt();Vt.value={...Vt.value,...t.data},Ot.value=e,wi({orderInfo:e})},la=e=>{try{let t=[];return Object.keys(e).forEach(a=>{e[a].forEach(e=>{t.push({field:a,error:e})})}),{data:t,total:t.length,other:{}}}catch(t){return{data:[],total:0,other:{}}}},na=({oid:e})=>{window.open("/ssl?action=download_cert&oid=".concat(e))},ra=async({oid:e,title:t,domainName:a})=>{try{const s=Nt.value.name,l=Dt.value;await c({title:"部署证书",isHtml:!0,content:"是否部署该证书,是否继续？<br>\n\t\t    证书类型：".concat(t,"<br>\n\t\t    证书支持域名：").concat(a.join("、"),"<br>\n\t\t    部署站点名:").concat(s)});const n={proxy:{oid:e,site_name:s},docker:{oid:e,site_name:s},default:{oid:e,siteName:s}},r=await Ft(n[l]||n.default);return oa(),yi(),Ht.value=!0,It.value=!0,Pt.value=!0,Xt("currentCertInfo"),r}catch(s){}},ia=async(e,t,a)=>{var s;const{data:l,status:n}=await zt(e,t,a);n&&_i({...l,cert_ssl_type:t,certType:t,pid:a}),null==(s=jt.value)||s.unmount()},oa=async()=>{try{const e=await Jt({siteName:Nt.value.name});return Ht.value=!1,e}catch(e){return{data:[],total:0,other:{}}}},ca=ge(!1),ua=ge(0),da=ge({}),pa={defalutList:[],domianNumList:[],classList:[],brandList:[],typeList:[]},ma=ge({addPrice:0,productName:"",price:0,totalPrice:0,originalPrice:0,deploymentPrice:0,pid:0,years:1,yearsPrice:0,number:1,extraNumber:0,extraPrice:0,install:1}),va=ge({num:1,certClassAcitve:"OV",certClass:[{name:"OV证书",title:"推荐企业使用",value:"OV",tips:[],data:[]},{name:"DV证书",title:"推荐个人，测试使用",value:"DV",subscript:"热销",tips:[]},{name:"EV证书",title:"推荐大型政企使用，高安全性",value:"EV",tips:[]}],certBrandAcitve:"",certBrand:[{name:"宝塔证书",title:"宝塔证书",value:"宝塔证书",tips:[]},{name:"Positive",title:"Positive",value:"Positive",tips:[]},{name:"锐安信",title:"锐安信",value:"锐安信",tips:[]},{name:"CFCA",title:"CFCA",value:"CFCA",tips:[]},{name:"Digicert",title:"Digicert",value:"Digicert",tips:[]},{name:"GeoTrust",title:"GeoTrust",value:"GeoTrust",tips:[]},{name:"Sectigo",title:"Sectigo",value:"Sectigo",tips:[]},{name:"亚洲诚信",title:"亚洲诚信",value:"亚洲诚信",tips:[]}],certTypeAcitve:"single",certType:[{name:"single",title:"单域名",value:"single",tips:[]},{name:"multiple",title:"多域名",value:"multiple",tips:[]},{name:"wildcard",title:"泛域名",value:"wildcard",tips:[]},{name:"ip",title:"IP证书",value:"ip",tips:[]}],certLifeAcitve:1,certLife:[{name:"1年",title:"1年",value:1,tips:[]},{name:"2年",title:"2年",value:2,tips:[]},{name:"3年",title:"3年",value:3,tips:[]},{name:"4年",title:"4年",value:4,tips:[]},{name:"5年",title:"5年",value:5,tips:[]}],certDeployAcitve:1,certDeploy:[{name:"不需要",title:"不需要",value:0,tips:[]},{name:"部署服务",title:"部署服务",value:1,tips:[]},{name:"部署服务（国密）",title:"部署服务（国密）",value:2,tips:[]}]}),fa={single:["仅支持绑定一个二级域名或者子域名，例如 bt.com、cloud.bt.com、dnspod.cloud.bt.com的其中之一 。","如需要绑定同级的所有子域名，例如*.bt.com，请购买泛域名证书。"],wildcard:["带通配符的域名，例如：*.bt.com、*.cloud.bt.com均为泛域名，包含同一级的全部子域名。","注意泛域名不支持跨级，例如*.bt.com 不包含 *.cloud.bt.com的支持"]},ha={0:[],1:["宝塔提供9:00 - 24:00的人工部署证书部署服务，帮助客户排查部署证书部署生效问题，快速上线"],2:["宝塔提供9:00 - 24:00的人工部署国密算法证书部署服务，帮助客户排查部署证书部署生效问题，快速上线"]},ya=Se(()=>{const e=va.value.certClass.filter(e=>e.value===va.value.certClassAcitve);return e&&e.length>0?e[0].tips:[]}),ga=Se(()=>{const e=va.value.certBrand.filter(e=>e.value===va.value.certBrandAcitve);return e&&e.length>0?e[0].tips:[]}),wa=Se(()=>{const e=va.value.certType.filter(e=>e.value===va.value.certTypeAcitve);return e&&e.length>0?e[0].tips:[]}),_a=Se(()=>{const e=va.value.certLife.filter(e=>e.value===parseInt(va.value.certLifeAcitve));return e&&e.length>0?e[0].tips:[]}),ba=Se(()=>{const e=va.value.certDeploy.filter(e=>e.value===parseInt(va.value.certDeployAcitve));return e&&e.length>0?e[0].tips:[]}),xa=async()=>{try{ca.value=!0;const{data:e,status:t}=await Gt();if(ca.value=!1,!t)return i.request({msg:"获取证书列表失败",status:!1}),{status:!1,msg:"获取证书列表失败"};da.value=e.info.recommend,Aa(),Ea(e.info),Na(e.data),Da()}catch(e){return{status:!1,msg:"获取证书列表失败"}}},Sa=(e=va.value.num)=>{let t=e;if(o(e)&&"number"!=typeof e?(e=Number(e.data),t=Number(va.value.num)||1):t=Number(va.value.num+e)||1,t&&(t<1||t>99))return va.value.num=t<1?1:99,i.error("域名数量范围为1-99");va.value.num=t,"wildcard"!==va.value.certTypeAcitve&&(va.value.certTypeAcitve=va.value.num>1?"multiple":"single"),Da()},ka=(e,t,a)=>{a||(a=va.value[t].filter(t=>t.value===e)),a.disable||("".concat(t,"Acitve")in va.value&&(va.value["".concat(t,"Acitve")]=e),"certClass"==t&&(va.value.certBrandAcitve=Ca()),Da())},Ca=()=>{var e;return da.value[null==(e=va.value.certClassAcitve)?void 0:e.toLowerCase()]},Aa=()=>{va.value.certClassAcitve="DV",va.value.certBrandAcitve=Ca(),va.value.certTypeAcitve="single",va.value.certLifeAcitve=1,va.value.certDeployAcitve=1},Ta=(e,t,a)=>e.map((e,s)=>{const l=a?a(e,t):t[e.value];return{...e,tips:l}}),Ea=({type:e,brand:t,times:a})=>{va.value.certClass=Ta(va.value.certClass,e,(e,t)=>t["".concat(e.value).toLowerCase()]),fa.multiple=fa.single,va.value.certType=Ta(va.value.certType,fa),va.value.certDeploy=Ta(va.value.certDeploy,ha),va.value.certBrand=Ta(va.value.certBrand,t,(e,t)=>t["Positive"!==e.value?"".concat(e.value).toLowerCase():"Positive"]),va.value.certLife=Ta(va.value.certLife,a,(e,t)=>t[e.value+"_year"])},La=(e={})=>{let{num:t,classify:a,brand:s,type:l,life:n,deploy:r}=e;const i=va.value;return t||(t=i.num),a||(a=i.certClassAcitve),s||(s=i.certBrandAcitve),l||(l=i.certTypeAcitve),n||(n=i.certLifeAcitve),r||(r=i.certDeployAcitve),{num:t,classify:a,brand:s,type:l,life:n,deploy:r}},Na=e=>{const t=[];e.forEach(e=>{var a;const s=null==(a=e.type.match(/(OV|DV|EV)/))?void 0:a[0],l=-1!==e.code.indexOf("wildcard"),n=-1!==e.code.indexOf("ip"),r=e.add_price>0;let i=l?"wildcard":r?"multiple":"single";"Digicert"===e.brand&&(i=l?"wildcard":"single"),t.push({...e,type:s,certType:i,isMulti:r,isIp:n})}),pa.defalutList=t},Da=()=>{Ia(pa.defalutList),Ra(),ja()},Ia=e=>{let{num:t}=La();const a=e.filter(e=>!(t>1)||e.isMulti);a.length>0&&(pa.domianNumList=a,Pa(a))},Pa=e=>{const{classify:t}=La(),a=e.filter(e=>e.type===t);a.length>0&&(pa.classList=a,Oa(a))},Oa=e=>{const{brand:t}=La(),a=e.filter(e=>e.brand===t);a.length>0&&(pa.brandList=a,Va(a))},Va=e=>{const{type:t}=La();1===e.length&&(va.value.certTypeAcitve=e[0].certType);const a=e.filter(e=>{const a="multiple"===va.value.certTypeAcitve&&"wildcard"!==e.certType&&e.isMulti,s="wildcard"===va.value.certTypeAcitve&&"wildcard"===e.certType&&e.isMulti,l="ip"===va.value.certTypeAcitve&&e.isIp;return e.certType===t||a||s||l});a.length>0&&(pa.typeList=a)},Ra=()=>{const{domianNumList:e,classList:t,brandList:a,typeList:s}=pa;va.value.certClass.forEach(t=>{let a=e.some(e=>e.type===t.value);"EV"==t.value&&"wildcard"===va.value.certTypeAcitve&&(a=!1),t.disable=!a}),va.value.certBrand.forEach(e=>{var a,s,l;const n=!t.some(t=>t.brand===e.value);if(e.hidden=n,e.subscript=e.value===Ca()?"推荐":"",e.value===va.value.certBrandAcitve&&e.hidden){va.value.certBrandAcitve=Ca(),e.value===va.value.certBrandAcitve&&e.hidden&&(va.value.certBrandAcitve=null==(s=null==(a=null==pa?void 0:pa.classList)?void 0:a[0])?void 0:s.brand);const t=null==(l=null==pa?void 0:pa.classList)?void 0:l.filter(e=>e.brand===va.value.certBrandAcitve);t.length>0&&(pa.brandList=t,Va(t))}}),va.value.certType.forEach(e=>{let t=!a.some(t=>!(!t.isIp||"ip"!==e.value)||t.certType===e.value);"single"===e.value&&va.value.num>1&&(t=!0),"multiple"===e.value&&1===va.value.num&&(t=!0),"multiple"===e.value&&va.value.num>1&&(t=!1),"ip"===e.value&&va.value.num>1&&(t=!0),e.hidden=t}),"CFCA"!==va.value.certBrandAcitve&&2===va.value.certDeployAcitve&&(va.value.certDeployAcitve=1)},ja=()=>{const e=pa.typeList[0]||null;if(ua.value=(null==e?void 0:e.num)||0,e){const{num:t,life:a,deploy:s}=La(),{price:l,other_price:n,add_price:r,pid:i,num:o,install_price:c,install_price_v2:u}=e,d=t-o<0?0:t-o,p=[0,c,u][s],m=r*d,v=(m+l)*a+p,f=n+m+p;ma.value={addPrice:r||0,productName:e.title,price:l,totalPrice:v,originalPrice:f,deploymentPrice:p,pid:i,years:a,yearsPrice:l*a,number:o,extraNumber:d,extraPrice:m,install:Number(s)}}},Ha=ge({oid:0,wxcode:"",alicode:"",qq:"",orderInfo:{}}),qa=async e=>{const{pid:a,install:s,years:l,extraNumber:n}=ma.value,r={pdata:JSON.stringify({pid:a,install:s,years:l,num:n})},{data:o,msg:c}=await t({loading:"正在创建商业证书订单，请稍后...",request:I(r)}),{status:u}=o;if(!u)return i.error(c);const{oid:d,wxcode:p,alicode:m,qq:v,order_info:f}=o.msg;Ha.value={oid:d,wxcode:p,alicode:m,qq:v,orderInfo:f},Fi({...Ha.value,productInfo:ma.value})},Ba=[{content:"通配符证书只支持DNS验证"}],Ma=[{content:"多域名只支持DNS验证"}],Ua=ge(!1),Fa=ge(!1),Ja=ge(""),za=ge(""),Ga=ge([]),Ka=ge([]),Xa=ge(!1),Za=ge(),Ya=ge({domain:""}),Qa=ge("CNAME_CSR_HASH"),Wa=ge(!0),$a=ge("dns"),es=ge(!1),ts=ge(!1),as=ge(!1),ss=ge([]),ls=[{content:"https或者http验证，必须保证网站能通过http/https访问"},{content:"域名前缀是www,提醒用户解析上级根域名，如申请www.bt.cn，请确保解析bt.cn"},{content:()=>we("a",{class:"text-primary",href:"https://www.bt.cn/bbs/thread-85379-1-1.html",target:"_blank"},[_e("如何验证商用证书?")])}],ns=[{content:"申请之前，请确保域名已解析，如未解析会导致审核失败(包括根域名)"},{content:"申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败"},{content:"SSL证书可选名称赠送规则："},{content:"1、申请根域名(如：bt.cn),赠送下一级为www的域名(如：www.bt.cn)"},{content:"2、申请当前host为www的域名（如：www.bt.cn）,赠送上一级域名，(如: bt.cn)"},{content:"3、申请其它二级域名，(如：app.bt.cn)，赠送下一级为www的域名 (如：www.app.bt.cn)"}],rs=ge([{value:"CNAME_CSR_HASH",label:"DNS验证(CNAME解析)",tips:"如网站还未备案完成，可选【DNS验证】",isCheck:"",checkTips:[]},{value:"HTTP_CSR_HASH",label:"文件验证(HTTP)",tips:"如网站未开启301、302、强制HTTPS、反向代理功能，请选择HTTP",isCheck:"",checkTips:[]},{value:"HTTPS_CSR_HASH",label:"文件验证(HTTPS)",tips:"如网站开启【强制HTTPS】，请选【HTTPS验证】",isCheck:"",checkTips:[]}]),is=(e,t,a)=>{switch(t&&(Qa.value="HTTP_CSR_HASH"),a.value){case"CNAME_CSR_HASH":return!t;case"HTTP_CSR_HASH":case"HTTPS_CSR_HASH":return!e}},os=[{content:"OV/EV证书申请流程条件："},{content:"1、填写网站验证信息(文件验证或DNS验证)"},{content:"2、完成邮箱认证，根据CA发送的邮件完善邮件内容(中文填写即可)"},{content:"3、企查查或者爱企查、百度地图、114best能查询到相关企业信息，且公司名和公司地址完全匹配"},{content:"4、企查查或其他平台留下的电话能保证周一到周五(7:00 - 15:00)能接听到CA的认证电话，电话号码归属地来自美国，请留意接听。"}],cs=Se(()=>{const e=[];return ts.value&&e.push(...Ba),es.value&&e.push(...Ma),e.push(...ls),"dv"!==Ot.value.type&&e.push(...os),e}),us=Se(()=>{const e=ts.value?"*":"www";return es.value?"请输入".concat(ts.value?"通配符":"","证书域名，例如：").concat(e,".bt.cn"):"请输入需要申请证书的域名（单域名".concat(ts.value?"通配符":"","证书），例如：").concat(e,".bt.cn")}),ds=ge({domains:"",interface:"",dcvMethod:"",auth_to:"",Administrator:{address:"",city:"",country:"",email:"",firstName:"",lastName:"",job:"",name:"",mobile:"",organation:"",postCode:"",state:""}}),ps=Se(()=>ds.value.Administrator.lastName+ds.value.Administrator.firstName),ms=()=>{vs(),ds.value.Administrator={...Vt.value,name:""},ds.value.Administrator.name=ps.value;const{pid:e,oid:t,title:a,limit:s,install:l,code:n}=Ot.value,r=n.indexOf("ev")>-1?"ev":n.indexOf("ov")>-1?"ov":"dv";es.value=n.indexOf("multi")>-1,ts.value=n.indexOf("wildcard")>-1,as.value=n.indexOf("ip")>-1,Ot.value={pid:e,oid:t,title:a,limit:s,install:l,isMulti:es.value,isWildcard:ts.value,isIp:as.value,type:r}},vs=async()=>{var e,t;try{const{data:a}=await ht();ss.value=a.map(e=>({label:e.ps?"".concat(e.dns_name," - ").concat(e.ps):e.dns_name,value:e.id,domains:e.domains,ps:e.ps}));const{limit:s}=Ot.value;if(!es.value)return ds.value.interface=null==(t=null==(e=ss.value)?void 0:e[0])?void 0:t.value;Wt.value=Array.from({length:s},(e,t)=>{var a,s;return{key:"domain_".concat(t+1),value:"",interface:(null==(s=null==(a=ss.value)?void 0:a[0])?void 0:s.value)||""}})}catch(a){}},fs=async()=>{var e,t;try{const a=await Kt();Ga.value=a.data.map(e=>({label:e.name,value:e.name,...e})),Ua.value=!0,za.value=(null==(t=null==(e=Ga.value)?void 0:e[0])?void 0:t.name)||"",Ka.value=Ga.value}catch(a){}},hs=e=>{Ga.value=[],Ka.value.forEach(t=>{t.name.indexOf(e)>-1&&Ga.value.push(t)}),Ga.value.length||(Ga.value=Ka.value)},ys=async()=>{ds.value.domains=za.value,Ua.value=!1,ts.value||gs()},gs=async()=>{Xa.value=!0;const{data:e}=await D(za.value);Xa.value=!1,rs.value.forEach(t=>{l(e[t.value])?(t.isCheck=!!e[t.value],t.checkTips=!!e[t.value]):(t.isCheck=!1,t.checkTips=e[t.value])})},ws=ke({domain:[a({message:"域名不能为空"}),{validator:(e,t,a)=>{s(t)?!ts.value&&t.indexOf("*")>-1?a(new Error("当前为单域名证书，不支持通配符申请")):a():a(new Error("域名格式错误，请重新输入"))},trigger:["change"]}]}),_s=()=>{Fa.value=!0},bs=async()=>{var e;await(null==(e=Za.value)?void 0:e.validate()),ds.value.domains=Ya.value.domain,Fa.value=!1,ts.value||gs()},xs=e=>{const t=$a.value;if("dns"!==t){const a=qt.value.find(e=>e.value===t);if(a){const t=!a.data;(!e||e&&t)&&Si({title:"设置".concat(a.info.title,"接口"),row:a.info})}}},Ss=async(e,t)=>{var a;let s=null;if(!e.value.domains&&!es.value)return i.error("域名不能为空");if(Ot.value.isIp&&!u(e.value.domains))return i.error("IP证书申请域名格式错误，请输入正确的ipv4地址");if(!e.value.Administrator.state&&!e.value.Administrator.city)return i.error("所在地区不能为空");if(!e.value.Administrator.address&&"dv"!==Ot.value.type)return i.error("公司详细地址不能为空");if(!e.value.Administrator.organation)return i.error("公司名称不能为空");if(!e.value.Administrator.name)return i.error("姓名不能为空");if(!e.value.Administrator.email)return i.error("邮箱不能为空");if(!e.value.Administrator.mobile)return i.error("手机不能为空");try{s=i.load("正在提交证书信息，请稍后...");const{job:l,postCode:n,country:r,firstName:c,lastName:u,name:d,state:p,city:m,address:v,organation:f,email:h,mobile:y}=e.value.Administrator,g=await P(JSON.stringify({pid:Ot.value.pid,cert_ssl_type:t,oid:Ot.value.oid,domains:es.value?Wt.value.map(({value:e})=>null==e?void 0:e.trim()):[ds.value.domains.trim()],dcvMethod:Qa.value,auth_to:$a.value,Administrator:{job:l,postCode:n,country:r,lastName:d,state:p,city:m,address:v,organation:f,email:h,mobile:y}}));if(o(g.data.msg)&&g.data.msg.hasOwnProperty("code")){let e=g.data.errors;Yt.value=[],Object.keys(e).forEach(t=>{e[t].forEach((e,a)=>{Yt.value.push({field:t,error:e})})}),Zt.value=!0}else{let e=g.msg||g.data.msg,t=g.data.status;i.request(g.data||{msg:t?e||"提交成功":e||"资料提交错误，请检查管理员信息是否填写正确，如填写错误请联系客服重置订单",status:t})}if(g.data.status){Ht.value=!0;const{data:e,status:s}=await zt(Ot.value.oid,t,Ot.value.pid);e&&(e.auto_verify_info={interface:es.value?Wt.value:ds.value.interface,set_verify_value:!0},_i({...e,cert_ssl_type:t,certType:t,pid:Ot.value.pid})),null==(a=jt.value)||a.unmount()}}catch(l){}finally{s&&s.close()}},ks=async(e,a)=>{const s="CNAME_CSR_HASH"===Ns.value,{DCVdnsValue:l,DCVdnsHost:n,DCVfileContent:r,DCVfileName:i,DCVdnsType:o}=Rt.value.data;try{const c=s?[{record_type:o,sub_domain:n,dns_value:l,dns_id:"",domain:e.url}]:[{file_name:"/.well-known/pki-validation/".concat(i),file_value:r,domain:e.url}],{data:u}=await t({loading:"正在验证商用证书，请稍后...",request:ft({verify_type:s?"dns":"file",verify_data:JSON.stringify(c),set_verify_value:!1})}),{local_verify:d,status:p}=u.data[0].rep;Ds.value[a].status=d,Ds.value[a].verify_status=p}catch(c){}},Cs=async()=>{var e,t;const{data:a}=await zt(Rt.value.oid,Rt.value.cert_ssl_type,Rt.value.pid);a&&(Rt.value=a),await Es(),"PENDING"===(null==(e=Rt.value)?void 0:e.certStatus)&&i.success("验证中，请耐心等待！"),"COMPLETE"===(null==(t=Rt.value)?void 0:t.certStatus)&&i.success("验证成功！"),jt.value.unmount(),Ht.value=!0},As=e=>{let t=Rt.value.res&&Rt.value.res.verification&&-1==Rt.value.res.verification.indexOf("dns");Ls({oid:Rt.value.oid,type:Ns.value,certType:Rt.value.certType,pid:Rt.value.pid,isIp:t})},Ts=ge([{content:"本次验证结果是由【本服务器验证】，实际验证将由【CA服务器】进行验证，请耐心等候"},{content:"请确保以上列表所有项都验证成功后点击【验证域名】重新提交验证"},{content:"如长时间验证不通过，请通过【修改验证方式】更改为【DNS验证】"},{content:()=>we("span",null,[_e("如何添加域名解析，《"),we("a",{href:"https://cloud.tencent.com/document/product/302/3446",class:"text-primary",target:"__blink"},[_e("点击查看教程")]),_e("》，和咨询服务器运营商")])}]),Es=async()=>{var e;if(null==(e=Rt.value)?void 0:e.data){const{data:{dcvList:e,DCVdnsHost:a,DCVdnsType:s,DCVdnsValue:l,DCVfileName:n,DCVfileContent:r},paths:i,auto_verify_info:o}=Rt.value;Is.value=null==e?void 0:e.map(e=>e.domainName).join(","),Ns.value=e[0].dcvMethod;const c={dnsHost:a,dnsType:s,dnsValue:l,fileName:n,fileContent:r,filePath:"/.well-known/pki-validation/"};return(async()=>{var e;Qt.value=!0;const{auto_verify_info:a}=kt.value,{dcvList:s,DCVdnsValue:l,DCVdnsHost:n,DCVfileContent:r,DCVfileName:i,DCVdnsType:o}=kt.value.data,c="CNAME_CSR_HASH"===Ns.value;let u=[];try{const d=e=>{if(!a)return"";if("string"==typeof a.interface)return a.interface;const t=((null==a?void 0:a.interface)||[]).find(t=>(null==t?void 0:t.value)===e);return(null==t?void 0:t.interface)||""};u=c?null==s?void 0:s.map(e=>({record_type:o,sub_domain:n,dns_value:l,dns_id:d(e.domainName),domain:e.domainName})):null==s?void 0:s.map(e=>({file_name:"/.well-known/pki-validation/".concat(i),file_value:r,domain:e.domainName}));const{data:p}=await t({request:ft({verify_type:c?"dns":"file",verify_data:JSON.stringify(u),set_verify_value:Boolean(a)})});Ds.value=null==(e=p.data)?void 0:e.map(e=>({url:e.domain,status:e.rep.local_verify,verify_status:e.rep.status,msg:e.rep.msg,content:i}))}catch(d){}finally{Qt.value=!1}})(),"CNAME_CSR_HASH"!==Ns.value&&Ts.value.splice(3,1,{content:()=>we("span",null,[_e("SSL添加文件验证方式 ->> "),we("a",{href:"https://www.bt.cn/bbs/thread-56802-1-1.html",target:"_blank",class:"text-primary"},[_e("查看教程")])])}),c}return i.error("获取数据失败"),{}},Ls=e=>n({title:"验证域名-"+(e.type.indexOf("CNAME_")>-1?"DNS验证":"文件验证"),area:52,showFooter:!0,btn:["更改","取消"],component:()=>r(()=>import("./modify-verify-way.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),compData:e}),Ns=ge(""),Ds=ge([]),Is=ge(),Ps=e=>{const t=(e,t)=>we("span",{class:"bt-link",onClick:t},[e]),a=t("人工服务",()=>gt()),s=t("详情",()=>(e=>{n({title:"多年期证书详情",area:52,compData:e,component:()=>r(()=>import("./mulit-cert-detail.js?v=1764728423"),__vite__mapDeps([]),import.meta.url)})})(e)),l=t("下载",()=>na(e)),i=t("部署",()=>ra(e)),o=t("验证",()=>ia(e.oid,e.cert_ssl_type,e.pid)),c=t("续签",()=>Ui(e.oid)),u=t("完善资料",()=>sa(e)),d=e.orderStatus,p=[];switch(e.years&&e.years>1&&[5,15].includes(Number(d))&&p.push(s),Number(d)){case 0:e.install&&p.push(a),p.push(u);break;case 3:case 11:e.install&&p.push(a),p.push(o);break;case 5:p.push(i),p.push(l);break;case 7:p.push(c)}const m=[];return p.map((e,t)=>{m.push(e),t<p.length-1&&m.push(we(lt,null,null))}),m},Os={id:"wechat-customer",class:"wechat-customer"},Vs={class:"w-full h-[46px] flex flex-row items-center justify-center"},Rs={class:"qrcode-wechat w-[128px] h-[128px] m-[8px_0_4px_0]"},js={id:"wechatCustomerQrcode"},Hs=m(Te({__name:"customer-popover",props:{trigger:{default:"click"},showArrow:{type:Boolean,default:!0},placement:{default:"left"}},setup(e,{expose:t}){const a=e,s=ge(null),l=Se(()=>a.trigger),n=Se(()=>a.showArrow),r=Se(()=>a.placement);return t({BtCustomerPopover:()=>s}),(e,t)=>{const a=d,i=p,o=Ae;return Ee(),Le(o,Pe({ref_key:"BtCustomerPopover",ref:s},e.$attrs,{trigger:Oe(l),placement:Oe(r),effect:"light","popper-class":"BtCustomerPopover","show-arrow":Oe(n),"popper-style":{padding:"0",border:"0",background:"0"}}),{reference:Ne(()=>[De(e.$slots,"default",{},void 0,!0)]),default:Ne(()=>[Ie("div",Os,[Ie("div",Vs,[we(a,{target:"_blank",href:"https://www.bt.cn/new/wechat_customer",class:"text-[16px] flex flex-row flex-nowrap items-center"},{default:Ne(()=>[...t[0]||(t[0]=[Ie("div",{class:"flex items-center border-b border-solid border-[var(--el-color-primary-light-9)] pb-4px"},[_e(" 点击咨询客服 "),Ie("i",{class:"svgtofont-el-d-arrow-right ml-4px w-[15px]"})],-1)])]),_:1})]),Ie("div",Rs,[Ie("div",js,[we(i,{src:"/customer/customer-qrcode.png"})])]),t[1]||(t[1]=Ie("div",{class:"wechat-title"},[Ie("img",{class:"icon",style:{width:"17px",height:"17px"},src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABkAAAAZCAYAAADE6YVjAAAAAXNSR0IArs4c6QAAATlJREFUSEvtVrFOw0AMfed8AxJsZWGAgQHBXP4DCQa+Ioou7g18BRIg9T/KDGJggIGFbiDxDXGQowSBuGvrFISEmtF+7/nis312RVEMiWgIoMT375aIjpj5KeJrTMy8JSJjAPsRzEhErl1Zlhd1XZ8kRKZEdMjM0xlBBiIyATCIYZxzl857X6uTiHaY+TElZrUz87aIPCjvI0gIwVmF5uG7H1gFmZepxv85XTdqCCEcLMQ0gLz3jbbTOm/rPdkLBt0v0E77xysq2it9T2nhuTzPN4ho10KyYEXkXvvkBcC6hWjEvmqQMwCnANZa8p1RJAbfa41vAM7/0cUzczOiZ43zvunrtPVOntuO3+wrluJ12qspvFBm/+bR+u03nhPrkKZk2ZVINUZO964sy44Ta9FSK5GuQ1VVXb0DLf+sHQ9tLL0AAAAASUVORK5CYII="}),Ie("div",{class:"scan-title",style:{"font-size":"16px"}},"扫一扫")],-1)),t[2]||(t[2]=Ie("span",{class:"layui-layer-setwin wechat-close",style:{display:"block"}},[Ie("a",{href:"javascript:;",class:"layui-layer-ico layui-layer-close layui-layer-close2"})],-1))])]),_:3},16,["trigger","placement","show-arrow"])}}}),[["__scopeId","data-v-9064b685"]]),qs={class:"h-full"},Bs={class:"recommendList"},Ms={class:"text-small ml-[8px] text-stroke-primary"},Us={class:"flex flex-col w-full pt-[16px]"},Fs={class:"flex items-center"},Js={class:"flex items-center"},zs=m(Te({__name:"index",setup(e,{expose:t}){const{sslAlertState:a,isRefreshSSL:s}=it(),{BtTable:l,BtRefresh:n,refresh:r}=v({request:oa,columns:[{label:"域名",prop:"domainName",width:120,render:(e,t)=>we("span",{class:"w-full whitespace-pre-line"},[e.domainName?e.domainName.join("、"):"--"])},{label:"证书类型",prop:"title",showOverflowTooltip:!0},{label:"到期时间",width:100,render:ta,showOverflowTooltip:!0},{label:"状态",prop:"expire",width:160,showOverflowTooltip:!1,render:(e,t)=>{const a=[],s=(e,t)=>we("span",{style:"color: ".concat(e,";")},[t]),l=we(Ae,{placement:"bottom-end",width:"400","popper-class":"white-theme",trigger:"click"},{default:()=>we("div",{class:"bus-ssl-popover"},[we("div",{class:"ssl-popover-item"},[we("span",{class:"ssl-popover-title"},[_e("自行排查")]),we("p",null,[_e("以图文的形式，一步步教您验证并部署商业SSL")]),we("a",{class:"bt-link",href:"https://www.bt.cn/bbs/thread-85379-1-1.html",target:"_blank"},[_e("如何验证商用证书?")])]),we("div",{class:"ssl-popover-item"},[we("span",{class:"ssl-popover-title"},[_e("购买人工")]),we("p",null,[_e("不会部署?人工客服帮你全程部署，不成功可退款")]),we(Ce,{size:"small",type:"primary",onClick:()=>aa(e)},{default:()=>[_e("购买人工")]})])]),reference:()=>we("span",{class:"bt-link"},[_e("排查方法?")])});if(e.cert_ssl_type)return(e=>{const t=we(Ae,{placement:"bottom-end",width:"400","popper-class":"white-theme",trigger:"click"},{default:()=>we("div",{class:"bus-ssl-popover"},[we("div",{class:"ssl-popover-item"},[we("span",{class:"ssl-popover-title"},[_e("自行排查")]),we("p",null,[_e("以图文的形式，一步步教您验证并部署商业SSL")]),we("a",{class:"bt-link",href:"https://www.bt.cn/bbs/thread-85379-1-1.html",target:"_blank"},[_e("如何验证商用证书?")])]),we("div",{class:"ssl-popover-item"},[we("span",{class:"ssl-popover-title"},[_e("购买人工")]),we("p",null,[_e("不会部署?人工客服帮你全程部署，不成功可退款")]),we(Ce,{size:"small",type:"primary",onClick:()=>aa(e)},{default:()=>[_e("购买人工")]})])]),reference:()=>we("span",{class:"bt-link"},[_e("排查方法?")])}),a=e.orderStatus,s=[];switch(Number(a)){case-1:s.push(we("span",{class:"text-danger"},[_e("已取消")]));break;case 0:s.push(we("span",{class:"text-warning"},[_e("待完善资料")])),e.install||s.push(t);break;case 1:s.push(we("span",{class:"text-warning"},[_e("待审核")]));break;case 2:s.push(we("span",{class:"text-warning"},[_e("正在提交CA")]));break;case 3:s.push(we("span",{class:"text-warning"},[_e("待域名验证")]));break;case 4:s.push(we("span",{class:"text-warning"},[_e("签发中")]));break;case 5:s.push(we("span",{class:"text-success"},[_e("已签发")]));break;case 6:s.push(we("span",{class:"text-warning"},[_e("取消确认")]));break;case 7:s.push(we("span",{class:"text-warning"},[_e("待续费")]));break;case 8:s.push(we("span",{class:"text-warning"},[_e("待吊销确认")]));break;case 9:s.push(we("span",{class:"text-warning"},[_e("待重颁发")]));break;case 10:s.push(we("span",{class:"text-warning"},[_e("重颁发中")]));break;case 11:s.push(we("span",{class:"text-warning"},[_e("吊销中")]));break;case 12:s.push(we("span",{class:"text-danger"},[_e("已吊销")]));break;default:s.push(we("span",{class:"text-warning"},[_e("待完善资料")]))}const l=[];return s.map((e,t)=>{l.push(e),t<s.length-1&&l.push(we(lt,null,null))}),l})(e);let n=e.domainName&&e.domainName.length>0;if(""!=e.certId||n)if(""==e.certId&&0!==e.domainName.length)a.push(we("span",{class:"bt-warn"},[_e("待提交")]));else if(1===e.status)switch(e.orderStatus){case"COMPLETE":a.push(s("primary","订单完成"));break;case"PENDING":a.push((r="orange",i="验证中",we(Ae,{trigger:"hover",placement:"left","popper-class":"popover-default",width:"300",enterable:!1,"open-delay":100,"close-delay":0},{default:()=>we("div",{class:"flex items-center p-[2px] whitespace-nowrap"},[_e("1、如填写错误，联系人工可重置订单"),we("br",null,null),_e("2、如验证方式选择错误，联系人工修改验证方式")]),reference:()=>we("div",{style:"color: ".concat(r,";")},[i])})));break;case"CANCELLED":a.push(s("medium","已取消"));break;case"REISSUED":a.push(s("primary","已重签"));break;case"FAILED":a.push(s("danger","申请失败"));break;case"EXPIRED":a.push(s("medium","已过期"));break;default:a.push(s("orange","待验证"))}else switch(e.status){case 0:a.push(s("orange","未支付"));break;case-1:a.push(s("medium","已取消"))}else a.push(we("span",{class:"bt-warn",onClick:()=>sa(e)},[_e("待完善资料")])),a.push(l);var r,i;const o=[];return a.map((e,t)=>{o.push(e),t<a.length-1&&o.push(we(lt,null,null))}),o}},{label:"操作",prop:"ps",width:170,align:"right",render:(e,t)=>{if(e.cert_ssl_type)return Ps(e);const a=(e,t)=>we("span",{class:"bt-link",onClick:t},[e]),s=a("人工服务",()=>gt()),l=a("下载",()=>na(e)),n=a("部署",()=>ra(e)),r=a("验证",()=>ia(e.oid,e.cert_ssl_type,e.pid)),o=a("续签",()=>Ui(e.oid)),c=[],u=e.domainName&&e.domainName.length>0;if(""!=e.certId||u)if(""==e.certId&&0!==e.domainName.length)c.push(a("提交",()=>(async e=>{try{const{data:t}=await Ut({oid:e.oid});if(-1===t.code&&t.errors)la(t.errors),Zt.value=!0;else{let a=t.msg||t.data.msg,s=t.status;i.request({msg:s?a||"提交成功":"资料提交错误，请检查管理员信息是否填写正确，如填写错误请联系客服重置订单",status:s}),s&&ia(e.oid,e.cert_ssl_type,e.pid)}oa()}catch(t){}})(e)));else if(1===e.status)switch(e.orderStatus){case"COMPLETE":1===e.ssl_state?c.push(we("span",null,[_e("已部署")])):c.push(n),e.endDay<30&&c.push(o),c.push(l);break;case"PENDING":default:e.install&&c.push(s),c.push(r);break;case"CANCELLED":c.push(we("span",null,[_e("无操作")]));break;case"FAILED":c.push(we("span",{class:"bt-danger cursor-default"},[_e("申请失败")]));break;case"EXPIRED":c.push(n),c.push(l);case"REISSUED":}else c.push(we("span",null,[_e("无操作")]));else e.install&&c.push(s),c.push(a("完善资料",()=>sa(e)));const d=[];return c.map((e,t)=>{d.push(e),t<c.length-1&&d.push(we(lt,null,null))}),d}}],extension:[f(),h(s)]}),o=Ve(()=>{const e=document.querySelector("#pane-busSslList");e&&e.click()},1e3);return t({init:r}),(e,t)=>{const s=Ce,r=p,i=ye,c=y;return Ee(),Re("div",qs,[Ie("div",Bs,[(Ee(!0),Re(je,null,He(Oe($t),(e,a)=>(Ee(),Re("div",{key:a,class:qe("".concat(6===a?"w-[22rem]":"w-[14rem]"," recomItem"))},[t[0]||(t[0]=Ie("i",{class:"svgtofont-el-check font-bold text-[#ff8d00] text-medium"},null,-1)),Ie("span",Ms,Be(e),1)],2))),128))]),Ie("div",Us,[we(i,null,{"header-left":Ne(()=>[Ie("div",Fs,[we(s,{type:"primary",onClick:Oe(vi),class:"mr-4"},{default:Ne(()=>[...t[1]||(t[1]=[_e(" 申请证书 ",-1)])]),_:1},8,["onClick"]),we(Hs,{placement:"right"},{default:Ne(()=>[Ie("div",Js,[we(r,{src:"/static/icons/we-com.svg",class:"mx-[4px] w-2rem h-2rem",all:!0}),t[2]||(t[2]=Ie("span",{class:"bt-link"},"售前客服",-1))])]),_:1})])]),"header-right":Ne(()=>[we(Oe(n))]),content:Ne(()=>[we(Oe(l),{"max-height":Oe(a)?320:380,onWheel:Oe(o)},null,8,["max-height","onWheel"])]),_:1})]),we(c,{options:Oe(ea),listStyle:"disc"},null,8,["options"])])}}}),[["__scopeId","data-v-4fa3e526"]]),{siteType:Gs,siteInfo:Ks}=ct(),{isRefreshSSL:Xs}=it(),Zs=[{label:"所有",value:0},{label:"未过期",value:1},{label:"即将过期",value:2},{label:"已过期",value:3}],Ys=ge(!1),Qs=ge(),Ws=ge({}),$s=ge(!1),el=ke({typeValue:"全部",btnText:"部署证书",search:"",data:{all:[],site:[]},siteList:[]}),tl=async(e=Gs.value)=>{if(0===el.siteList.length)return void i.error("请选择站点");const{hash:t,subject:a}=Ws.value;await bi({hash:t,subject:a,list:el.siteList,type:e}),$s.value=!1},al=async e=>{await c({title:"删除证书",content:"删除后该证书将不会显示在证书夹，是否继续操作？",icon:"warning-filled"}),await t({loading:"正在删除证书...",request:O({local:e.cloud_id>0?0:1,ssl_hash:e.hash}),message:!0}),rl.value=!0};ge([nt(),{label:"站点名称",prop:"name",render:e=>e.current?e.name+"(当前站点)":e.name}]);const sl=async e=>{let a={},s=!0;void 0!==e&&(a={cert_list:JSON.stringify(e.dns)},s=!1,Ws.value=e);const l=await t({request:"docker"===Gs.value?V(a):R(a),data:{all:Array,site:Array}});el.data={all:l.all.map(e=>({name:e})),site:l.site.map(e=>({name:e}))},s||($s.value=!0,Me(()=>{var e;el.data.all.forEach((e,t)=>{e.name===Ks.value.name&&(e.current=!0,el.data.all.unshift(el.data.all.splice(t,1)[0]))}),null==(e=Qs.value)||e.toggleRowSelection(el.data.all.find(e=>e.name===Ks.value.name),!0)}))},ll=e=>{el.siteList=e,e.length<=0?el.btnText="部署证书":el.btnText="部署证书[已选择".concat(e.length,"项]")},nl=e=>{el.typeValue=e},rl=ge(!1),il=async()=>{rl.value=!0,Xs.value=!0,i.success("获取成功")},ol=async(e,a=rl.value)=>{try{const s={search_limit:e.search_limit,search_name:e.search,force_refresh:Number(a)};rl.value=!1;const{data:l}=await t({loading:Ys,request:H(s)});return g(l)||i.request(l),a&&i.success("获取成功"),{data:l,total:0,other:{}}}catch(s){return{data:[],total:0,other:{}}}},cl={class:"relative h-[45rem]"},ul={class:"p-[20px]"},dl={class:"flex flex-col p-[12px] bg-light"},pl={class:"mb-[4px]"},ml={class:"mb-[4px]"},vl={class:"mb-[4px]"},fl={class:"flex justify-between mb-[1rem]"},hl={class:"absolute bottom-0 w-full bg-light flex items-center justify-end p-[12px]"},yl=Te({__name:"index",setup(e,{expose:a}){it();const s=_({key:"search_limit",options:Zs,other:{class:"!w-[10rem] mr-1rem",filterable:!0}}),{BtTable:l,BtSearch:n,BtTableSelect:r,refresh:i}=w({request:ol,columns:[{label:"域名",prop:"subject",render:e=>{var t;return Ue("div",{class:"whitespace-pre-wrap"},(null==(t=e.dns)?void 0:t.join("\n"))||e.subject)}},{label:"到期时间",prop:"not_after"},{label:"品牌",prop:"info.issuer",showOverflowTooltip:!0},{label:"位置",render:e=>e.cloud_id>0?"云端":"本地"},rt([{onClick:async e=>{await(async e=>{try{await c({title:"上传云端证书",content:"将会上传证书信息至云端进行替换，是否继续操作？",icon:"warning-filled",type:"calc"}),await t({loading:"正在上传证书至云端...",request:j({ssl_hash:e.hash}),message:!0}),Xs.value=!0}catch(a){}})(e),i()},width:60,title:"上传云端",isHide:e=>e.cloud_id>0},{onClick:sl,title:"部署"},{onClick:al,title:"删除"}])],extension:[s,h(rl)]});return a({init:i}),(e,t)=>{const a=Ce,s=b,i=Ge,o=Ke,c=x,u=ye,d=Fe("bt-loading");return Ee(),Re("div",null,[we(u,null,{"header-left":Ne(()=>[we(a,{type:"default",onClick:Oe(il)},{default:Ne(()=>[...t[4]||(t[4]=[_e(" 从云端同步 ",-1)])]),_:1},8,["onClick"])]),"header-right":Ne(()=>[Ie("div",null,[we(Oe(r))]),we(Oe(n),{class:"w-[30rem]",placeholder:"请输入域名搜索"})]),content:Ne(()=>[we(Oe(l),{"max-height":500})]),popup:Ne(()=>[we(c,{title:"部署当前证书",modelValue:Oe($s),"onUpdate:modelValue":t[3]||(t[3]=e=>Je($s)?$s.value=e:null),area:52},{default:Ne(()=>{var e;return[Ie("div",cl,[Ie("div",ul,[Ie("div",dl,[Ie("span",pl,"认证域名："+Be(Oe(Ws).subject),1),Ie("span",ml,"证书类型："+Be(null==(e=Oe(Ws).info)?void 0:e.issuer),1),Ie("span",vl,"到期时间："+Be(Oe(Ws).not_after),1)]),t[5]||(t[5]=Ie("span",{class:"!mt-[24px] !mb-[4px] inline-block"},"如下是需要批量部署证书的站点：",-1)),Ie("div",fl,[we(s,{type:"button",modelValue:Oe(el).typeValue,"onUpdate:modelValue":t[0]||(t[0]=e=>Oe(el).typeValue=e),size:"default",options:[{label:"全部",value:"全部"},{label:"匹配站点",value:"匹配站点"}],onChange:Oe(nl)},null,8,["modelValue","onChange"])]),ze((Ee(),Le(o,{ref_key:"deploySiteTableRef",ref:Qs,onSelectionChange:Oe(ll),data:Oe(el).data["全部"===Oe(el).typeValue?"all":"site"],"max-height":180},{default:Ne(()=>[we(i,{type:"selection",width:"55"}),we(i,{label:"站点名称",prop:"name"},{default:Ne(e=>[_e(Be(String(e.row.name)+(e.row.current?"(当前站点)":"")),1)]),_:1})]),_:1},8,["onSelectionChange","data"])),[[d,"正在加载中，请稍后...","title"],[d,Oe(Ys)]])]),Ie("div",hl,[we(a,{type:"info",onClick:t[1]||(t[1]=e=>$s.value=!1)},{default:Ne(()=>[...t[6]||(t[6]=[_e("取消",-1)])]),_:1}),we(a,{type:"primary",onClick:t[2]||(t[2]=e=>Oe(tl)())},{default:Ne(()=>[_e(Be(Oe(el).btnText),1)]),_:1})])])]}),_:1},8,["modelValue"])]),_:1})])}}}),{sslInfo:gl,sslTabActive:wl}=it(),{siteInfo:_l,siteType:bl,isRefreshList:xl}=ct(),{isRefreshLocalList:Sl}=xe(pt()),kl=[{content:()=>we("span",null,[_e("粘贴您的*.key以及*.pem内容，然后保存即可"),we("a",{href:"http://www.bt.cn/bbs/thread-704-1-1.html",class:"text-primary",target:"_blank"},[_e("[帮助]")]),_e("。")])},{content:"如果浏览器提示证书链不完整,请检查是否正确拼接PEM证书"},{content:"PEM格式证书 = 域名证书.crt + 根证书(root_bundle).crt"},{content:"在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"},{content:"如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"}],Cl=e=>{switch(e){case 3:wl.value="busSslList";break;case 2:wl.value="trustAsiaList";break;case 1:wl.value="letsEncryptList";break;case 0:wl.value="currentCertInfo";break;default:wl.value="certFolderList"}},Al=ge(!1),Tl=ge(!1),El=async e=>{e?ut({onCancel:()=>{gl.value.pushAlarm=!e}}):(Tl.value="all"===gl.value.push.task_data.project,Al.value=!0)},Ll=()=>{gl.value.pushAlarm=!0},Nl=async()=>{let e;Al.value=!1;try{e=i.load("正在关闭证书到期提醒，请稍后...");const t=(()=>{const{id:e,task_data:t,sender:a}=gl.value.push;return{template_id:1,task_id:e,status:0,task_data:JSON.stringify({task_data:{status:!1,type:"site_ssl",project:Tl.value?"all":_l.value.name,cycle:parseInt(t.cycle),title:"网站SSL到期提醒",interval:600,tid:1},sender:a,time_rule:{send_interval:0,time_range:[0,86399]},number_rule:{day_num:0,total:3}})}})(),a=await q(t);i.request(a),a.status&&yi()}catch(t){}finally{e&&e.close()}},Dl=async()=>{let e=!1;const{key:a,csr:s,type:l}=gl.value,{name:n}=_l.value;if(!Pl.value&&!Ol.value)return i.error("请填写完整的证书内容");Pl.value===a&&Ol.value===s||(e=!0,await c({title:"证书保存提示",content:"当前证书内容发生改变，证书信息将同步更新，继续操作？"}));const r={proxy:{site_name:n,key:Pl.value,csr:Ol.value},docker:{site_name:n,key:Pl.value,csr:Ol.value},default:{type:e?0:l,siteName:n,key:Pl.value,csr:Ol.value}};await t({loading:"正在保存证书信息，请稍后...",request:B(r[bl.value]||r.default,bl.value),message:!0,success:e=>{e.status&&(xl.value=!0,Sl.value=!0,yi())}})},Il=async e=>{try{e||await c({title:"关闭强制HTTPS",content:"关闭强制HTTPS后需要清空浏览器缓存才能生效,是否继续操作?",icon:"warning-filled"});const{name:a}=_l.value,s=bl.value,l={proxy:{site_name:a,force_https:e?"1":"0"},docker:{site_name:a,force_https:e?"1":"0"},default:{siteName:a}},n=l[s]||l.default,r={proxy:M,docker:U,default:e?F:J},i=r[s]||r.default;await t({loading:"正在".concat(e?"开启":"关闭","强制HTTPS，请稍后..."),request:i(n),message:!0}),await yi()}catch(a){gl.value.https=!e}},Pl=Se({get:()=>gl.value.key,set:e=>{gl.value.key=e}}),Ol=Se({get:()=>gl.value.csr,set:e=>{gl.value.csr=e}}),Vl=async()=>{const e={siteName:_l.value.name,pem:Ol.value,key:Pl.value},{status:a,msg:s}=await t({loading:"正在下载证书，请稍后...",request:z(e),data:{status:Boolean,msg:String}});a&&window.open("/download?filename="+encodeURIComponent(s))};let Rl=!0;const jl=()=>{try{Rl?Rl=!1:fi()}catch(e){}},Hl=()=>{var e;try{let t={};const{push:a}=gl.value;if(a&&(a.status,1)){const{sender:e,module:s,status:l,id:n}=gl.value.push,{cycle:r}=a.task_data;t={cycle:r||30,push:Array.isArray(e)?e:e?e.split(","):[],dueAlarm:a.status,id:n||(new Date).getTime(),domainName:_l.value.name}}return"all"===(null==(e=null==a?void 0:a.task_data)?void 0:e.project)&&a.status&&(t.allSsl=!0),{data:t,status:!0}}catch(t){return{status:!1,msg:"获取证书到期提醒配置失败"}}},ql=async(e,a)=>{try{await a();const s=(e=>{const{id:t,allSsl:a,push:s,cycle:l,dueAlarm:n}=e;return{template_id:1,task_id:gl.value.push.id,status:n?1:0,task_data:JSON.stringify({task_data:{status:n,type:"site_ssl",project:a?"all":_l.value.name,cycle:parseInt(l),title:"网站SSL到期提醒",interval:600,tid:1},sender:s,time_rule:{send_interval:0,time_range:[0,86399]},number_rule:{day_num:0,total:3}})}})(e.value),l=await t({loading:"正在设置到期提醒，请稍后...",request:q(s),message:!0});return yi(),l.status}catch(s){return!1}},Bl=async(e,t)=>{if(!t)try{const t=await navigator.clipboard.readText(),a="key"===e?[/-----BEGIN PRIVATE KEY-----[\s\S]*?-----END PRIVATE KEY-----/,/-----BEGIN RSA PRIVATE KEY-----[\s\S]*?-----END RSA PRIVATE KEY-----/,/-----BEGIN EC PRIVATE KEY-----[\s\S]*?-----END EC PRIVATE KEY-----/]:[/-----BEGIN CERTIFICATE-----[\s\S]*?-----END CERTIFICATE-----/,/-----BEGIN CERTIFICATE REQUEST-----[\s\S]*?-----END CERTIFICATE REQUEST-----/];for(const s of a){const a=t.match(s);if(a&&a[0])switch(i.success("已从粘贴板检测到".concat("key"===e?"密钥":"证书")),e){case"key":Pl.value=a[0];break;case"cert":Ol.value=a[0]}}}catch(a){}},Ml=async e=>{try{e(),"docker"===bl.value?vt("httpsOfficersSite"):mt("httpsOfficersSite")}catch(t){}},Ul=async()=>{try{await t({request:G({siteName:_l.value.name})}),await yi()}catch(e){}},Fl={class:"flex flex-col w-full overflow-y-hidden"},Jl={class:"flex items-center justify-between w-full"},zl={class:"flex"},Gl={class:"mr-[32px] text-small"},Kl={key:1,class:"ssl-status-info"},Xl={class:"left flex-1"},Zl=["title"],Yl={class:"!mb-0"},Ql={class:"right flex-1"},Wl=["title"],$l={key:0},en={key:1,class:"text-danger"},tn={class:"!mb-0"},an={class:"flex items-center"},sn={class:"flex flex-1 justify-start"},ln={class:"flex-1 mr-[20px]"},nn={class:"flex-1"},rn={class:"my-[16px]"},on={class:"p-2rem"},cn={class:"flex"},un={class:"ml-4"},dn={class:"mt-8px flex items-center"},pn=m(Te({__name:"index",setup(e,{expose:t}){const{sslInfo:a}=it(),s=["宝塔证书","Let's Encrypt","宝塔SSL","商业证书"],l=Se(()=>-1!==a.value.type?s[a.value.type]:s[0]),n=Xe("popupClose",()=>{});return Ze(jl),t({init:jl}),(e,t)=>{var s,r,i,o,c,u,p;const m=Qe,v=d,f=We,h=$e,g=Ce,w=y,_=et,b=tt,S=x;return Ee(),Re("div",Fl,[(null==(s=Oe(a))?void 0:s.isCertInfo)&&!(null==(r=Oe(a))?void 0:r.httpsMode)&&(null==(i=Oe(a))?void 0:i.isStart)?(Ee(),Le(m,{key:0,type:"error",class:"!mb-[16px]",onClose:Oe(Ul)},{default:Ne(()=>[Ie("div",Jl,[Ie("div",zl,[Ie("div",Gl,[t[13]||(t[13]=_e("网站安全：未开启HTTPS防窜站，站点访问可能存在风险。",-1)),Ie("span",{class:"ml-[1rem] bt-link",onClick:t[0]||(t[0]=e=>Oe(Ml)(Oe(n)))},">>前往开启")])])])]),_:1},8,["onClose"])):Ye("",!0),(null==(o=Oe(a))?void 0:o.isCertInfo)?(Ee(),Re("div",Kl,[Ie("div",Xl,[Ie("div",null,[t[14]||(t[14]=Ie("span",null,"证书分类：",-1)),Ie("span",null,[we(v,{onClick:t[1]||(t[1]=e=>Oe(Cl)(Oe(a).type))},{default:Ne(()=>[_e(Be(Oe(l)),1)]),_:1})])]),Ie("div",null,[t[15]||(t[15]=Ie("span",null,"认证域名：",-1)),Ie("span",{class:"truncate max-w-24rem",title:Oe(a).dns.join("、")},Be(Oe(a).dns.join("、")),9,Zl)]),Ie("div",Yl,[t[16]||(t[16]=Ie("span",null,"强制HTTPS：",-1)),Ie("span",null,[we(f,{size:"small",class:"!mb-0",modelValue:Oe(a).https,"onUpdate:modelValue":t[2]||(t[2]=e=>Oe(a).https=e),onChange:Oe(Il)},null,8,["modelValue","onChange"])])])]),Ie("div",Ql,[Ie("div",null,[t[17]||(t[17]=Ie("span",null,"证书品牌：",-1)),Ie("span",{class:"truncate max-w-24rem",title:Oe(a).issuer},Be(Oe(a).issuer),9,Wl)]),Ie("div",null,[t[18]||(t[18]=Ie("span",null,"到期时间：",-1)),Ie("span",null,[Number(Oe(a).endtime)>0?(Ee(),Re("span",$l,Be(Oe(a).notAfter),1)):(Ee(),Re("span",en,"证书已过期"))])]),Ie("div",tn,[t[20]||(t[20]=Ie("span",null,"到期提醒：",-1)),Ie("span",an,[we(f,{size:"small",class:"!mb-0",modelValue:Oe(a).pushAlarm,"onUpdate:modelValue":t[3]||(t[3]=e=>Oe(a).pushAlarm=e),onChange:Oe(El)},null,8,["modelValue","onChange"]),we(v,{class:"ml-[8px]",onClick:t[4]||(t[4]=e=>Oe(ut)())},{default:Ne(()=>[...t[19]||(t[19]=[_e(" 到期设置提醒 ",-1)])]),_:1})])])])])):Ye("",!0),Ie("div",sn,[Ie("div",ln,[t[21]||(t[21]=Ie("div",{class:"mb-[4px]"},"密钥(KEY)",-1)),we(h,{type:"textarea",rows:12,modelValue:Oe(Pl),"onUpdate:modelValue":t[5]||(t[5]=e=>Je(Pl)?Pl.value=e:null),onFocus:t[6]||(t[6]=e=>Oe(Bl)("key",Oe(Pl)))},null,8,["modelValue"])]),Ie("div",nn,[t[22]||(t[22]=Ie("div",{class:"mb-[4px]"},"证书(PEM格式)",-1)),we(h,{type:"textarea",rows:12,modelValue:Oe(Ol),"onUpdate:modelValue":t[7]||(t[7]=e=>Je(Ol)?Ol.value=e:null),onFocus:t[8]||(t[8]=e=>Oe(Bl)("cert",Oe(Ol)))},null,8,["modelValue"])])]),Ie("div",rn,[we(g,{type:"primary",class:"mr-[4px]",onClick:Oe(Dl)},{default:Ne(()=>{var e;return[_e(Be((null==(e=Oe(a))?void 0:e.isStart)?"保存":"保存并启用证书"),1)]}),_:1},8,["onClick"]),(null==(c=Oe(a))?void 0:c.isSupportRenewal)||1===(null==(u=Oe(a))?void 0:u.type)?(Ee(),Le(g,{key:0,type:"primary",class:"mr-[4px]",onClick:t[9]||(t[9]=e=>Oe(Hi)())},{default:Ne(()=>[...t[23]||(t[23]=[_e(" 续签证书 ",-1)])]),_:1})):Ye("",!0),Oe(a).csr?(Ee(),Le(g,{key:1,type:"default",class:"mr-[4px]",onClick:t[10]||(t[10]=e=>Oe(Vl)())},{default:Ne(()=>[...t[24]||(t[24]=[_e(" 下载证书 ",-1)])]),_:1})):Ye("",!0),(null==(p=Oe(a))?void 0:p.isStart)?(Ee(),Le(g,{key:2,type:"default",onClick:Oe(Ji)},{default:Ne(()=>[...t[25]||(t[25]=[_e(" 关闭SSL ",-1)])]),_:1},8,["onClick"])):Ye("",!0)]),we(w,{options:Oe(kl),"list-style":"disc",class:"ml-[20px]"},null,8,["options"]),we(S,{title:"关闭证书到期提醒",showFooter:"",modelValue:Oe(Al),"onUpdate:modelValue":t[12]||(t[12]=e=>Je(Al)?Al.value=e:null),onConfirm:Oe(Nl),onCancel:Oe(Ll),area:["auto"]},{default:Ne(()=>[Ie("div",on,[Ie("div",cn,[t[28]||(t[28]=Ie("i",{class:"svgtofont-el-warning-filled !text-[4rem] text-warning"},null,-1)),Ie("div",un,[t[27]||(t[27]=Ie("div",{class:"py-[.3rem] leading-[2.4rem] text-base"},"关闭证书到期提醒后将不在提醒和证书到期，是否继续操作？",-1)),Ie("div",dn,[t[26]||(t[26]=Ie("div",null,"应用配置",-1)),we(b,{modelValue:Oe(Tl),"onUpdate:modelValue":t[11]||(t[11]=e=>Je(Tl)?Tl.value=e:null),class:"!w-[20rem] ml-2rem"},{default:Ne(()=>[we(_,{label:"应用到当前站点",value:!1}),we(_,{label:"应用到所有未设置过的站点",value:!0})]),_:1},8,["modelValue"])])])]),we(w,{options:[{content:"任务优先级：单个站点的任务优先于所有站点的任务。"}],"list-style":"disc",class:"ml-4rem mt-2rem"})])]),_:1},8,["modelValue","onConfirm","onCancel"])])}}}),[["__scopeId","data-v-ec17f944"]]),{siteInfo:mn,siteType:vn}=ct(),{isRefreshLetSSL:fn,sslDnsApiInfo:hn,otherPopup:yn}=it(),{jumpSslTabEvent:gn}=ot(),wn=ge(!1),_n=ke({}),bn=ge([]),xn=ge([]),Sn=ge(!1),kn=ge(""),Cn=ge(!1),An=e=>{var t;const a=(null==(t=e.domains)?void 0:t.length)>0,s=a?(l=e.endDay)<=0||l<=7?"text-danger":l<=15?"text-orange":"text-primary":"text-default";var l;const n=a?e.endDay>0?"剩余".concat(e.endDay,"天"):"已过期":"--";return we("span",{class:s},[n])},Tn=e=>{let t="";if("pending"===e.status){if(e.expires<(new Date).getTime()/1e3)return t=we("span",null,[_e("--")]),t;t=we("span",{class:"text-[#e6a23c]"},[_e("待验证")])}else t=we("span",{class:"text-primary"},[_e("订单完成")]);return t},En=[{content:()=>we("span",{class:"text-danger"},[_e("注意：请勿将SSL证书用于非法网站")])},{content:()=>we("span",null,[_e("Let's Encrypt 证书申请和续签限制"),we("a",{class:"bt-link",href:"https://letsencrypt.org/zh-cn/docs/rate-limits/",target:"_blank"},[_e("点击查看")])])},{content:()=>we(je,null,[_e("Let's Encrypt因更换根证书，部分老旧设备访问时可能提示不可信，考虑购买")," ",we("span",{class:"bt-link",onClick:()=>gn("busSslList")},[_e("[商业证书]")])])},{content:"申请之前，请确保域名已解析，如未解析会导致审核失败"},{content:"Let's Encrypt免费证书，有效期3个月，支持多域名。默认会自动续签"},{content:"若您的站点使用了CDN或301重定向会导致续签失败"},{content:"在未指定SSL默认站点时未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"},{content:"如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"}],Ln=ge([{label:"解析域名",prop:"domain"},{label:"记录值",showOverflowTooltip:!0,prop:"auth_value",render(t,a){const s="dns"===_n.auth_type?t.auth_value:t.file_path;return we("div",{class:"flex items-center"},[we("div",{class:"truncate w-[15rem]"},[s]),we("span",{class:"svgtofont-icon-copy ml-[4px] text-secondary text-medium w-[1.6rem] cursor-pointer",onClick:()=>e({value:s})},null)])}},{label:"类型",prop:"type",render:(t,a)=>"dns"===_n.auth_type?we("span",null,[t.type]):we("div",{class:"flex items-center"},[we("div",{class:"truncate w-[15rem]"},[t.content]),we("span",{class:"svgtofont-icon-copy ml-[4px] text-secondary text-medium w-[1.6rem] cursor-pointer",onClick:()=>e({value:t.content})},null)])},{label:"必需",prop:"must",width:100}]),Nn=ge(!1),Dn=async()=>{try{const e=await t({loading:Nn,request:Q({siteName:mn.value.name}),data:Array});return{data:e,total:e.length,other:{}}}catch(e){return{data:[],total:0,other:{}}}},In=async({index:e},a=!1,s=mn.value.name)=>{try{const l={index:e,siteName:s},n=await t({loading:"正在部署证书，请稍候...",request:"docker"===vn.value?$(l):ee(l),message:!1,data:{status:Boolean,msg:String}});return xi(n,a),n.status&&gn("currentCertInfo"),{status:n.status,msg:n.msg}}catch(l){return{status:!1,msg:"部署失败"}}},Pn=async e=>{const t=await Ei(),{data:a}=await se({index:_n.index,domain:e.domain});t._props.onCancel(),"valid"===a.status?i.success("验证成功"):!0===a.status?(wn.value=!1,In(a,!0)):Ti(a,e.data,_n)},On=async()=>{const e=await Ei(),a=await t({request:ne({index:_n.index}),message:!1});e._props.onCancel(),!0===a.status?(wn.value=!1,In(a,!0)):Ti({msg:a.data},bn.value,_n)},Vn=()=>{Cn.value=!1,zi({})},Rn=ge([{content:"解析域名需要一定时间来生效,完成所以上所有解析操作后,请等待1分钟后再点击验证按钮"},{content:""},{content:"若您使用的是宝塔云解析插件,阿里云DNS,DnsPod作为DNS,可使用DNS接口自动解析"}]),jn=ge([]),Hn=ge("dns"),qn=ge(!1),Bn=async(e={id:mn.value.id})=>{try{const a=await t({request:"docker"==vn.value?K(e):X(e),data:{domains:Array}});return Gn.domain=a.domains.map(e=>e.name),jn.value=a.domains,Cn.value&&(Gn.checkAll=!0,Jn(!0)),{data:a.domains,status:!0,msg:"获取站点数据成功"}}catch(a){return{status:!1,msg:"获取站点数据失败"}}},Mn=async e=>{try{e=at(e.value);const t=vn.value,a=mn.value.name;if(0===e.checkList.length)return i.error("请选择一个域名"),!1;const s=jn.value.filter(t=>e.checkList.includes(t.name));if("1"===e.resource&&$n(s)&&!Gn.auth_to)return i.error("选中的域名存在未设置DNS接口配置"),!1;if("1"===e.resource&&e.autoWildcard&&e.checkList.some(e=>-1!==e.indexOf("*")))return i.error("开启自动组合泛域名时不能选择泛域名"),!1;let l={domains:JSON.stringify(e.checkList),auth_type:"1"==e.resource?"dns":"http",auth_to:"1"===e.resource&&e.auth_to?"dns":JSON.stringify(e.checkList),auto_wildcard:e.autoWildcard?"1":"0",id:mn.value.id};const n=await Ei(),r={proxy:{...l,site_name:a},docker:{...l,site_name:a},default:l},o=await Z(r[t]||r.default,t);n._props.onCancel();const c=await yn.value;return o.status&&(null==c||c.unmount()),Di(o.data,e),fn.value=!0,o.status}catch(t){return i.error("程序发生错误！"),!1}},Un=e=>{n({isAsync:!0,title:"配置DNS接口",area:50,component:()=>r(()=>import("./set-domain-dns.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),compData:{row:e,refresh:Bn},showFooter:!0})},Fn=e=>{var t;const a=Hn.value;if("dns"!==a&&"http"!==a){const s=null==(t=hn.value)?void 0:t.find(e=>e.value===a);if(s){const t=!s.data;(!e||e&&t)&&Si({title:"设置".concat(s.info.title,"接口"),row:s.info})}}},Jn=e=>{const t=jn.value.filter(e=>1===e.apply_ssl);Gn.checkList=e?t.map(e=>e.name):[],qn.value=!1},zn=e=>{const t=e.length;Gn.checkAll=t===Gn.domain.length,qn.value=t>0&&t<Gn.domain.length},Gn=ke({resource:"0",auth_to:!1,autoWildcard:!1,checkAll:!1,domain:[],checkList:[]}),Kn=ge([{content:"如开启后无法使用HTTPS访问，请检查安全组是否正确放行443端口"},{content:()=>we("span",null,[_e("在DNS验证中，我们提供了多种自动化DNS-API，并提供了手动模式-"),we("span",{class:"bt-link",onClick:()=>{S(),k.push({name:"domain"})}},[_e("点击添加DNS接口")])])},{content:"使用DNS接口申请证书可自动续期，手动模式下证书到期后需重新申请"}]),Xn=[{content:()=>we("span",{class:"text-danger"},[_e("注意：请勿将SSL证书用于非法网站")])},{content:"使用【DnsPod/阿里云DNS】等接口前您需要先在弹出的窗口中设置对应接口的API"}],Zn=ge([{content:()=>we("span",null,[" ",_e("Let's Encrypt 证书申请和续签限制")," ",we("a",{class:"bt-link",target:"_blank",href:"https://letsencrypt.org/zh-cn/docs/rate-limits/"},[_e("点击查看")])])},{content:"申请之前，请确保域名已解析，如未解析会导致审核失败"},{content:"Let's Encrypt免费证书，有效期3个月，支持多域名。默认会自动续签"},{content:"若您的站点使用了CDN或301重定向会导致续签失败"},{content:"在未指定SSL默认站点时,未开启SSL的站点使用HTTPS会直接访问到已开启SSL的站点"}]),Yn=Se(()=>{const e="0"===Gn.resource?Zn.value:Kn.value,t=Xn.concat([]);return t.splice(1,0,...e),t}),Qn=e=>/^(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)$/.test(e),Wn=()=>{Object.assign(Gn,{resource:"0",auth_to:!1,autoWildcard:!1,checkAll:!1,domain:[],checkList:[]})},$n=e=>e.some(e=>0===e.dns_status),er=ge("正在申请证书..."),tr=ge(),ar=async()=>{tr.value=setInterval(async()=>{try{await t({request:re({filename:"/www/server/panel/logs/letsencrypt.log",num:10}),data:{msg:[String,er]}})}catch(e){clearInterval(tr.value)}},2e3)},sr=ge(),lr=ge([{title:"文件验证 - HTTP",name:"http",data:!1,config:!1}]),nr=async e=>{const{dns:t,id:a}=e;let s={domains:JSON.stringify(t),auth_type:"http",auth_to:a||"dns",auto_wildcard:"0"};if("http"===Hn.value){const e=JSON.stringify(t);if(-1!==(null==e?void 0:e.indexOf("*.")))return i.error("包含通配符的域名不能使用文件验证(HTTP)!")}else{if("dns"!==Hn.value){const{data:e,info:{data:t}}=hn.value.find(e=>e.value===Hn.value);if(!e)return void i.error("指定dns接口没有设置密钥信息");s.auth_to="".concat(Hn.value,"|").concat(t[0].value,"|").concat(t[1].value)}s.auth_type="dns"}s.id=mn.value.id,s.siteName=mn.value.name;(await yn.value).unmount();const l=await Ei(),{data:n}="proxy"==mn.value.project_type||"nginx"==mn.value.project_type||"docker"==mn.value.project_type?await Y({...s,site_name:mn.value.name},"docker"==mn.value.project_type?"docker":"proxy"):await Z(s,vn.value);null==l||l.unmount(),Di(n,s)},rr=async()=>{Hn.value="http";const{data:e}=await ki();lr.value=[{title:"文件验证 - HTTP",name:"http",data:!1,config:!1}],e&&Array.isArray(e)&&(lr.value=lr.value.concat(e))},ir=ge([]),or=async()=>{try{await t({request:ie(),data:{data:[Array,ir]}})}catch(e){return{data:[],total:0,other:{}}}},cr=async e=>{try{if(!e.dns_id)return void i.error("请选择验证类型");const a={dns_id:e.dns_id,ids:JSON.stringify(e.ids)},s=await t({loading:"正在配置DNS接口，请稍候...",request:oe(a),message:!0});return s.status&&(e.dns_id="",e.ids=[],Bn()),s.status}catch(a){return!1}},ur=Te({__name:"index",setup(e,{expose:a}){const{isRefreshLetSSL:s,sslAlertState:l}=it(),{BtTable:r,BtRefresh:o,refresh:u}=v({request:Dn,columns:[{label:"域名",prop:"domains",render:(e,t)=>we("span",{class:"w-full whitespace-pre-line"},[e.domains?e.domains.join("\n"):"--"])},{label:"到期时间",prop:"expires",width:110,render:An},{label:"订单状态",prop:"status",width:80,render:Tn},{label:"验证方式",prop:"auth_type",width:80,render:(e,t)=>we("span",null,["dns"===e.auth_type?"DNS验证":"文件验证"])},{label:"操作",prop:"ps",width:190,showOverflowTooltip:!1,align:"right",render:(e,a)=>{let s=[];return"invalid"!==e.status&&("pending"!==e.status?s=[we("span",{class:"cursor-pointer bt-link",onClick:()=>In(e,!1)},[_e("部署")]),we(lt,null,null),we("span",{class:"cursor-pointer bt-link",onClick:()=>(async({index:e})=>{try{const a=await t({loading:"正在获取证书信息，请稍后...",request:W({index:e}),message:!1,data:{status:Boolean,msg:String}});return a.status?window.open(a.msg):i.request(a),{status:a.status,msg:a.msg}}catch(a){return{status:!1,msg:"下载失败"}}})(e)},[_e("下载")]),we(lt,null,null),we("span",{class:"cursor-pointer bt-link",onClick:()=>(async({index:e})=>{const a=await Ei(),s=await t({request:le({index:e}),message:!1,data:{status:Boolean,msg:String}});a._props.onCancel(),i.msg({dangerouslyUseHTMLString:!0,message:s.msg,type:s.status?"success":"error",duration:s.status?2e3:0,showClose:!s.status}),s.status&&Dn()})(e)},[_e("续签")]),we(lt,null,null)]:e.expires>=(new Date).getTime()/1e3&&(s=[we("span",{class:"cursor-pointer bt-link",onClick:()=>(async e=>{var a,s,l;const{data:r}=await t({loading:"正在验证证书申请状态，请稍后...",request:ae({index:e.index}),message:!1});if(r.hasOwnProperty("status")&&r.hasOwnProperty("msg"))i.request(r);else{xn.value=r.auths,r.hasOwnProperty("error")?(Sn.value=r.error,kn.value=r.error_msg):(Sn.value=!1,kn.value=""),Object.assign(_n,e),bn.value=[],null==(a=r.auths)||a.forEach(e=>{bn.value.push(e.data)});const t="dns"===e.auth_type;Ln.value[1].label=t?"记录值":"文件路径",Ln.value[1].prop=t?"auth_value":"file_path",Ln.value[2].label=t?"类型":"文件内容",Ln.value[2].prop=t?"type":"content",Rn.value[1].content="可通过CMD命令来手动验证域名解析是否生效: nslookup -q=txt _acme-challenge.".concat(null==(l=null==(s=bn.value[0])?void 0:s.domain)?void 0:l.replace("*.","")),n({title:"手动".concat("dns"===_n.auth_type?"解析TXT记录":"创建验证文件"),area:70,component:()=>we("div",{class:"p-[1.5rem]"},[_e("请按以下列表做TXT解析:"),we("span",{class:"ml-[.4rem] text-danger"},{errorMsg:kn}),we(ye,null,{content:()=>we("div",{class:"max-h-[38rem] overflow-auto"},[xn.value.map((e,t)=>e.data.length>0&&we("div",{key:t},[we("span",null,[_e("验证域名："),e.domain]),we(C,{class:"my-[1rem]",column:Ln.value,data:e.data},null),Sn.value&&we("div",{class:"flex justify-end"},[we(Ce,{type:"default",onClick:()=>Pn(e)},{default:()=>[_e("验证")]})])]))]),"footer-right":()=>!Sn.value&&we(Ce,{type:"default",onClick:On},{default:()=>[_e("验证")]})}),we(y,{options:Rn.value,listStyle:"disc",class:"ml-[20px]"},null)])}),fn.value=!0}})(e)},[_e("验证")]),we(lt,null,null)])),s.push(we("span",{class:"cursor-pointer bt-link",onClick:()=>(async({index:e})=>{try{await c({title:"删除证书订单",content:"确定删除证书订单吗？"});const a=await t({loading:"正在删除证书，请稍候...",request:te({index:e}),message:!0});return fn.value=!0,{status:a.status,msg:a.msg}}catch(a){return{status:!1,msg:"删除失败"}}})(e)},[_e("删除")])),s}}],extension:[f(),h(s)]});return a({init:u}),(e,t)=>{const a=Ce,s=ye,n=y;return Ee(),Re("div",null,[we(s,null,{"header-left":Ne(()=>[we(a,{type:"primary",onClick:Oe(Vn)},{default:Ne(()=>[...t[0]||(t[0]=[_e("申请证书",-1)])]),_:1},8,["onClick"])]),"header-right":Ne(()=>[we(Oe(o))]),content:Ne(()=>[we(Oe(r),{"default-sort":{prop:"date",order:"descending"},maxHeight:Oe(l)?280:320},null,8,["maxHeight"])]),_:1}),we(n,{options:Oe(En),"list-style":"disc",class:"pl-1rem"},null,8,["options"])])}}}),{siteInfo:dr,siteType:pr,isRefreshList:mr}=ct(),{isRefreshLocalList:vr}=xe(pt()),{payment:fr}=A(),{bindUser:hr}=st(fr.value),{isRefreshSSL:yr,sslTabActive:gr,otherPopup:wr,isRefreshBtSSL:_r}=it(),{jumpSslTabEvent:br}=ot(),xr=T(),Sr=["企业级证书","极速申请","防劫持/防篡改","提高SEO权重","赔付保证","不成功可退款","官方推荐"],kr=[{content:()=>we("span",{class:"text-danger"},[_e("如果您的站点有使用CDN、高防IP、反向代理、301重定向等功能，可能导致验证失败")])},{content:()=>we("span",{class:"text-danger"},[_e("原测试证书已经停止服务，如需查看证书列表请前往官网后台。点击"),we("a",{class:"bt-link",href:"https://www.bt.cn/admin/safe"},[" ",_e("官网后台")," "]),_e("跳转")])},{content:"申请www.bt.cn这种以www为二级域名的证书，需绑定并解析顶级域名(bt.cn)，否则将验证失败。"},{content:"商用证书相对于普通证书，具有更高的安全性、赔付保障和支持通配符和多域名等方式。"}],Cr=async e=>{const{p:t,limit:a}=e;try{const{data:e}=await yt({url:"/api/v1/ssl/get_order_list",p:t,limit:a}),{data:s}=e;return s?{data:s.data,total:s.count}:{data:[],total:0,other:{}}}catch(s){return{data:[],total:0,other:{}}}},Ar=e=>{var t;const a=null==(t=null==e?void 0:e.cert_info)?void 0:t.not_after;if(!a)return we("span",null,[_e("--")]);let s=0;if("string"==typeof a){const e=new Date(a).getTime();s=Number.isNaN(e)?0:e}if(!s)return we("span",null,[_e("--")]);const l=Math.ceil((s-Date.now())/864e5);if(l>30)return we("span",null,[new Date(s).toLocaleDateString()]);const n=l<=7?"text-danger":"text-warning",r=l>0?"剩余".concat(l," 天"):"已过期";return we("span",{class:n},[r])},Tr=()=>{if(!hr.value)return wt(),!1;gr.value="btSslList",n({isAsync:!0,title:"购买宝塔证书",area:[79],component:()=>r(()=>import("./index408.js?v=1764728423"),__vite__mapDeps([]),import.meta.url)})},Er=(e,t,a,s=300)=>{const l=we("div","string"==typeof e?{class:"flex items-center p-[2px] whitespace-pre-line"}:{class:"flex items-center p-[2px] whitespace-nowrap"},[e]);return we(Ae,{trigger:"hover",placement:"left","popper-class":"popover-default",width:s,enterable:!1,"open-delay":100,"close-delay":0},{default:()=>l,reference:()=>we("span",{class:a},[t])})},Lr=e=>{var t;const a=[];if(0===e.status)return[we("span",{class:"text-warning"},[_e("待完善资料")])];const s=null==(t=e.cert_info)?void 0:t.status;switch(Number(s)){case 0:a.push(Er("如填写错误，联系人工可重置订单","验证中","text-orange",240));break;case 1:a.push(we("span",{class:"text-primary"},[_e("已签发")]));break;case-1:a.push(Er("该订单存在异常，请联系人工重置订单","异常","text-danger",240));break;default:a.push(we("span",null,[_e("--")]))}return a},Nr=async e=>{try{wr.value=await n({title:"完善宝塔证书资料",area:68,component:()=>r(()=>import("./index417.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),compData:e})}catch(t){}},Dr=async e=>{wr.value=await n({title:"验证域名-"+(3===e.product_id?"文件验证":"DNS验证"),area:64,compData:e,component:()=>r(()=>import("./index418.js?v=1764728423"),__vite__mapDeps([]),import.meta.url)})},Ir=async e=>{const a=e.cert_info.certificate+"\n"+e.cert_info.ca_certificate,s=e.cert_info.private_key;try{const l=dr.value.name,n={default:{type:pr.value,siteName:l,key:s,csr:a}};await c({title:"部署证书",isHtml:!0,content:"是否部署该证书,是否继续？<br>\n              证书类型：".concat(e.product_name,"<br>\n              证书支持域名：").concat(e.cert_info.domain,"<br>\n              部署站点名:").concat(l)}),await t({loading:"正在部署证书，请稍后...",request:B(n[pr.value]||n.default,pr.value),message:!0,success:e=>{yi(),mr.value=!0,yr.value=!0,_r.value=!0,vr.value=!0,br("currentCertInfo")}})}catch(l){}},Pr=e=>{n({title:"证书详情",area:64,component:()=>r(()=>import("./index419.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),compData:e})},Or=async e=>{var t;const a=xr.load("正在下载证书，请稍后...");try{const{data:a}=await yt({url:"/api/v1/ssl/cert/download_cert",order_id:e.id});if(!(null==(t=a.data)?void 0:t.base64))return void xr.error("获取证书文件失败");const s=Vr(a.data.base64,"application/zip"),l=URL.createObjectURL(s),n=document.createElement("a");n.href=l,n.download=a.data.file_name,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(l),xr.success("证书下载成功")}catch(s){xr.error("下载证书失败，请稍后重试")}finally{a&&a.close()}},Vr=(e,t="application/octet-stream")=>{const a=e.replace(/^data:[^;]*;base64,/,""),s=atob(a),l=new Array(s.length);for(let r=0;r<s.length;r++)l[r]=s.charCodeAt(r);const n=new Uint8Array(l);return new Blob([n],{type:t})},Rr={class:"h-full"},jr={class:"flex flex-col w-full"},Hr={class:"recommendList"},qr={class:"text-small ml-[8px] text-stroke-primary"},Br={class:"flex flex-col w-full pt-[16px]"},Mr={class:"flex items-center"},Ur={class:"flex items-center"},Fr=m(Te({__name:"index",setup(e,{expose:t}){const{sslAlertState:a,isRefreshBtSSL:s}=it(),{BtTable:l,BtRefresh:n,refresh:r,BtPage:i}=E({request:Cr,columns:[{label:"域名",prop:"domain",width:120,render:e=>we("span",{class:"w-full whitespace-pre-line"},[e.cert_info?e.cert_info.domain:"--"])},{label:"证书类型",prop:"product_name",showOverflowTooltip:!0},{label:"到期时间",width:100,render:Ar,showOverflowTooltip:!0},{label:"状态",prop:"expire",width:160,showOverflowTooltip:!1,render:e=>Lr(e)},{label:"操作",prop:"ps",width:170,align:"right",render:e=>(e=>{var t;const a=(e,t)=>we("span",{class:"bt-link",onClick:t},[e]),s=[];if(0===e.status){const t=a("完善资料",()=>Nr(e));s.push(t)}else{const l=null==(t=e.cert_info)?void 0:t.status;if(0===l){const t=a("验证",()=>Dr(e));s.push(t)}else if(1===l){const t=a("部署",()=>Ir(e)),l=a("下载",()=>Or(e)),n=a("查看",()=>Pr(e));s.push(t),s.push(l),s.push(n)}}const l=[];return s.map((e,t)=>{l.push(e),t<s.length-1&&l.push(we(lt,null,null))}),l})(e)}],extension:[f(),h(s)]}),o=Ve(()=>{const e=document.querySelector("#pane-busSslList");e&&e.click()},1e3);return t({init:r}),(e,t)=>{const a=Ce,s=p,r=ye,c=y;return Ee(),Re("div",Rr,[Ie("div",jr,[Ie("div",Hr,[(Ee(!0),Re(je,null,He(Oe(Sr),(e,a)=>(Ee(),Re("div",{key:a,class:qe("".concat(6===a?"w-[22rem]":"w-[14rem]"," recomItem"))},[t[0]||(t[0]=Ie("i",{class:"svgtofont-el-check font-bold text-[#ff8d00] text-medium"},null,-1)),Ie("span",qr,Be(e),1)],2))),128))]),Ie("div",Br,[we(r,null,{"header-left":Ne(()=>[Ie("div",Mr,[we(a,{type:"primary",onClick:Oe(Tr),class:"mr-4"},{default:Ne(()=>[...t[1]||(t[1]=[_e(" 申请证书 ",-1)])]),_:1},8,["onClick"]),we(Hs,{placement:"right"},{default:Ne(()=>[Ie("div",Ur,[we(s,{src:"/static/icons/we-com.svg",class:"mx-[4px] w-2rem h-2rem",all:!0}),t[2]||(t[2]=Ie("span",{class:"bt-link"},"售前客服",-1))])]),_:1})])]),"header-right":Ne(()=>[we(Oe(n))]),content:Ne(()=>[we(Oe(l),{"max-height":300,onWheel:Oe(o)},null,8,["onWheel"])]),"footer-right":Ne(()=>[we(Oe(i),{size:"small"})]),_:1})])]),we(c,{class:"mt-2",options:Oe(kr),listStyle:"disc"},null,8,["options"])])}}}),[["__scopeId","data-v-9438a8f6"]]),{payment:Jr}=A(),{bindUser:zr}=st(Jr.value),{sslInfo:Gr,certVerifyInfo:Kr,sslTabActive:Xr,letApplyInfo:Zr,isRefreshSSL:Yr,pollingPopup:Qr,sslDnsApiInfo:Wr,productInfo:$r,orderInfo:ei,otherPopup:ti}=it(),{siteInfo:ai,siteType:si,isBindExtranet:li,isRefreshList:ni,batchConfig:ri,activeType:ii,isSiteMult:oi}=ct(),{isRefreshLocalList:ci}=xe(pt()),{getSSLInfoEvent:ui,jumpSslTabEvent:di}=ot(),pi=Se(()=>{var e,t;return'当前证书 -<span class="'.concat((null==(e=Gr.value)?void 0:e.isStart)?"text-primary":"text-danger",'">[').concat((null==(t=Gr.value)?void 0:t.isStart)?"已部署SSL":"未部署SSL","]</span>")}),mi=[{label:()=>we("span",{innerHTML:pi.value},null),name:"currentCertInfo",lazy:!0,render:()=>we(pn,null,null)},{label:"商用SSL证书",name:"busSslList",lazy:!0,render:()=>we(zs,null,null)},{label:"宝塔证书",name:"btSslList",lazy:!0,render:()=>we(Fr,null,null)},{label:"Let's Encrypt",name:"letsEncryptList",lazy:!0,render:()=>we(ur,null,null)},{label:"证书夹",name:"certFolderList",lazy:!0,render:()=>we(yl,null,null)}],vi=()=>{if(!zr.value)return wt(),!1;Xr.value="busSslList",n({isAsync:!0,title:"购买商业证书",area:[82],component:()=>r(()=>import("./apply-bus-ssl.js?v=1764728423"),__vite__mapDeps([]),import.meta.url)})},fi=()=>{var e,t;let a=null==(e=ai.value.project_type)?void 0:e.toLowerCase();si.value=a,li.value=!!(null==(t=ai.value.project_config)?void 0:t.bind_extranet);["php","html","phpasync","proxy","docker"].includes(a)&&(li.value=!0),li.value&&hi(),_t()},hi=async()=>{const e=i.load("正在获取站点证书部署信息，请稍候...");await yi(),e.close()},yi=async()=>{try{const{data:e}=await ui({siteName:ai.value.name});return gi(e),{data:e,status:!0,msg:"获取证书信息成功"}}catch(e){}},gi=e=>{const{type:t,httpTohttps:a,https_mode:s,index:l,auth_type:n,key:r,csr:i,cert_data:{dns:o=[],subject:c="",issuer:u="",endtime:d="",notAfter:p=""}={},push:m,status:v,oid:f}=e;Gr.value={...Gr.value,isCertInfo:!!c,https:a,httpsMode:s,type:t,key:r||"",csr:i||"",index:l||"",authType:n||"",oid:f,dns:o||[],subject:c,issuer:u,endtime:d,notAfter:p,push:m,pushAlarm:!!("object"==typeof m?m.status:m),isSupportRenewal:(()=>{let e=!1;return d<=30&&(e=!0),2===t&&d<0&&(e=!0),0!==t&&-1!==t||(e=!1),e})(),isStart:v}},wi=async e=>{ei.value=e.orderInfo,ti.value=await n({title:"完善商业证书资料",area:64,component:()=>r(()=>import("./bus-cert-verify-info.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),compData:e})},_i=async e=>{Kr.value=e,ti.value=await n({title:"验证域名-"+(e.isCNAME?"DNS验证":"文件验证"),area:64,component:()=>r(()=>import("./bus-cert-verify-way.js?v=1764728423"),__vite__mapDeps([]),import.meta.url)})},bi=async e=>{var a;const{hash:s,subject:l,list:n,type:r}=e;if(await c({title:"部署证书",content:"批量部署证书后，原有证书将被覆盖，是否继续？",icon:"warning-filled"}),oi.value){const{enable:e,exclude:a}=ri.value,r=bt(n,a,e,{params:{certName:l,project_type:ii.value.toUpperCase(),ssl_hash:s}});await t({loading:"正在部署证书，请稍候...",request:me(r),success:async e=>{let{data:t}=xt(e.data);t=t.map(e=>({...e,name:e.siteName})),St(t,{title:"部署证书"})}}),oi.value=!1,ni.value=!0,ci.value=!0}else{const e=n.map(e=>({ssl_hash:s,siteName:e.name,certName:l})),i={proxy:{BatchInfo:JSON.stringify(e),site_name:ai.value.name},docker:{BatchInfo:JSON.stringify(e),site_name:ai.value.name},default:{BatchInfo:JSON.stringify(e)}},o=i[r]||i.default,c=await t({loading:"正在部署证书，请稍候...",request:ve(o,r),data:{faildList:Array,successList:Array}});(null==(a=ai.value)?void 0:a.name)&&yi(),ni.value=!0,ci.value=!0,await dt({title:"批量部署结果",resultTitle:"部署证书操作",resultData:[...c.faildList.map(e=>({name:e.siteName,status:!1,msg:e.msg||e.error_msg})),...c.successList.map(e=>({name:e.siteName,status:!0}))]})}},xi=(e,t)=>{if(e.status)i.request(e),yi(),ni.value=!0,Yr.value=!0,ci.value=!0;else{const a=t?"当前证书已成功申请！自动部署失败，请尝试手动部署证书！\n":"";i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:a+e.msg,type:e.status?"success":"error",showClose:!e.status})}},Si=e=>n({isAsync:!0,title:e.title,area:50,component:()=>r(()=>import("./dns-verify-info.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),showFooter:!0,compData:e.row}),ki=async()=>{try{const e=await t({request:fe(),data:Array});return g(e)&&Ci(e),{data:e,status:!0}}catch(e){return{status:!1,msg:"获取DNS接口信息失败"}}},Ci=e=>{Wr.value=e.filter(e=>"CloudxnsDns"!==e.name).map(e=>({label:e.title,value:e.name,config:!!e.data,data:!!e.data&&""!=e.data[0].value,info:e}))},Ai=async e=>{try{const a={};e.forEach(e=>{a[e.key]=e.value});const s={pdata:JSON.stringify(a)},l=await t({loading:"正在配置DNS接口，请稍候...",request:he(s),message:!0});if(await ki(),l.status)return l.status}catch(a){return{status:!1,msg:"验证失败"}}},Ti=(e,t,a)=>{var s,l,n,r,o,c,u,d;if(e.msg&&L(e.msg))return void i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.msg,type:"error",showClose:!0,duration:0});let p="",m=e.msg[0];if(void 0===(null==(s=e.msg[1])?void 0:s.challenges))p+="\n\t\t\t<p><span>响应状态：</span>".concat(e.msg[1].status,"</p>\n\t\t\t<p><span>错误类型：</span>").concat(e.msg[1].type,"</p>\n\t\t\t<p><span>错误来源：</span><a href='https://letsencrypt.org/' style='color:#20a53a'>Let's Encrypt官网</a></p>\n\t\t\t<div class=\"flex flex-col\">\n\t\t\t\t错误代码：\n\t\t\t\t<pre class=\"!text-white !bg-[#333] !inline-block !ml-[4px]\">\n\t\t\t\t\t").concat(e.msg[1].detail,"\n\t\t\t\t</pre>\n\t\t\t</div>");else if(!(null==(l=e.msg[1])?void 0:l.challenges[1])&&(null==(n=e.msg[1])?void 0:n.challenges[0])&&(e.msg[1].challenges[1]=e.msg[1].challenges[0]),"invalid"===e.msg[1].status){let s="";for(const a of t){const t=a.outerText||a.auth_value;if(null==t?void 0:t.includes(e.msg[1].identifier.value)){const e=t.split("\t");if((null==e?void 0:e.length)>1){s=e[1];break}}}const l=null==(r=e.msg[1])?void 0:r.identifier.value,n=null==(o=e.msg[1])?void 0:o.challenges[1],i=null==n?void 0:n.error.detail;if(p+="\n\t\t\t\t<p><span>验证域名：</span>".concat(l,"</p>\n\t\t\t"),"dns"===(null==a?void 0:a.type)||"dns"===(null==a?void 0:a.auth_type)){const e="_acme-challenge.".concat(l);p+="\n\t\t\t\t\t<p><span>验证解析：</span>".concat(e,"</p>\n\t\t\t\t\t<p><span>验证内容：</span>").concat(s||n.token,'</p>\n\t\t\t\t\t<div class="flex flex-col">\n\t\t\t\t\t\t错误代码：\n\t\t\t\t\t\t<pre class="!text-white !bg-[#222] !inline-block !ml-[4px]">\n\t\t\t\t\t\t\t').concat(i,"\n\t\t\t\t\t\t</pre>\n\t\t\t\t\t</div>\n\t\t\t\t")}else{const t="http://".concat(l,"/.well-known/acme-challenge/").concat(null==(c=e.msg[1])?void 0:c.challenges[0].token);p+='\n\t\t\t\t\t<p><span>验证URL：</span><a class="text-primary" href=\''.concat(t,"' target='_blank'>点击查看</a></p>\n\t\t\t\t\t<p><span>验证内容：</span>").concat(null==(u=e.msg[1])?void 0:u.challenges[0].token,'</p>\n\t\t\t\t\t<div class="flex flex-col">\n\t\t\t\t\t\t错误代码：\n\t\t\t\t\t\t<pre class="!text-white !bg-[#222] !inline-block !ml-[4px]">\n\t\t\t\t\t\t\t').concat(null==(d=e.msg[1])?void 0:d.challenges[0].error.detail,"\n\t\t\t\t\t\t</pre>\n\t\t\t\t\t</div>\n\t\t\t\t")}p+="<p><span>验证结果：</span> <a class='text-danger'>验证失败</a></p>"}i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,icon:"x",message:'\n\t\t\t<div class="flex items-center justify-center mt-[.8rem] mb-2rem">\n\t\t\t\t<i class="svgtofont-el-circle-close-filled mr-[.8rem] text-danger !text-[3rem]"></i>\n\t\t\t\t<a style="color: red; font-size:16px">\n\t\t\t\t\t'.concat(m,'\n\t\t\t\t</a>\n\t\t\t</div>\n\t\t\t<div class="p-[2rem] border border-1 border-color-dark !rounded-base !mb-[12px] !leading-[26px] bg-light">\n\t\t\t\t').concat(p,"\n\t\t\t</div>\n\t\t"),showClose:!0,duration:0})},Ei=()=>n({area:[50,25],showFooter:!1,component:()=>r(()=>import("./lets-encrypt-progress.js?v=1764728423"),__vite__mapDeps([]),import.meta.url)}),Li=ge([{label:"解析域名",prop:"name"},{label:"记录值",prop:"txt",render:(t,a)=>we("div",{class:"flex items-center"},[we("div",{class:"truncate w-[15rem]"},[t.txt]),we("span",{class:"svgtofont-icon-copy ml-[4px] text-secondary text-medium w-[1.6rem] cursor-pointer",onClick:()=>e({value:t.txt})},null)])},{label:"类型",prop:"type"},{label:"必需",prop:"force",width:100}]),Ni=ge(),Di=(e,t)=>{if(!1===e.status&&e.hasOwnProperty("msg")&&L(e.msg))i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:e.msg,type:"error",showClose:!0,duration:0});else if(!0!==e.status&&"pending"!==e.status&&void 0===(null==e?void 0:e.save_path))Ti(e,Zr.value.dnsTable,Zr.value.info);else{if("pending"===e.status&&"dns"===e.auth_type){Oi(e,t);let a=[];e.auths.forEach(e=>{let t=[];const s=e.domain.replace("*.","");t.push({name:"_acme-challenge.".concat(s),type:"TXT",txt:e.auth_value,force:"是"}),t.push({name:s,type:"CAA",txt:'0 issue "letsencrypt.org"',force:"否"}),a.push({domain:e.domain,data:t})});const s=[{content:"解析域名需要一定时间来生效,完成所以上所有解析操作后,请等待1分钟后再点击验证按钮"},{content:"可通过CMD命令来手动验证域名解析是否生效: nslookup -q=txt _acme-challenge.".concat(e.auths[0].domain.replace("*.",""))},{content:"若您使用的是宝塔云解析插件,阿里云DNS,DnsPod作为DNS,可使用DNS接口自动解析"}],l=!!e.hasOwnProperty("error")&&e.error;return Object.assign(_n,e),void(Ni.value=n({title:"手动解析TXT记录",area:70,component:()=>we("div",{class:"p-[1.5rem]"},[_e("请按以下列表做TXT解析:"),we(ye,null,{content:()=>we("div",{class:"max-h-[38rem] overflow-auto"},[a.map((t,a)=>we("div",{key:a},[t.data.length>0&&we(je,null,[we("span",null,[_e("验证域名："),t.domain]),we(C,{class:"my-[1rem]",column:Li.value,data:t.data},null),l.value&&we("div",{class:"flex justify-end"},[we(Ce,{type:"default",onClick:()=>Ii({index:e.index,domain:t.domain})},{default:()=>[_e("验证")]})])])]))]),"footer-right":()=>!l.value&&we(Ce,{type:"default",onClick:On},{default:()=>[_e("验证")]})}),we(y,{options:s,listStyle:"disc",class:"ml-20x"},null)])}))}Vi(e)}},Ii=async e=>{const t=await Ei(),{data:a}=await se(e);if(null==t||t.unmount(),"valid"===a.status)i.success("验证成功");else if(!0===a.status){const e=await Ni.value;e&&e.unmount(),Pi(a,!0)}else Ti(a,Zr.value.dnsTable,Zr.value.info)},Pi=async({index:e},a=!1,s=ai.value.name)=>{const l=await t({loading:"正在部署证书，请稍候...",request:ee({index:e,siteName:s}),message:!1,data:{status:Boolean,msg:String}});xi(l,a)},Oi=(e,t)=>{Zr.value.dnsTable=e.auths,Zr.value.info.index=e.index,Zr.value.info.type=t.auth_type},Vi=async(e,a)=>{if(!e.private_key||!e.cert||!e.root)return void i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:"部署失败，请关闭SSL后重新尝试部署！",type:"error",showClose:!0,duration:0});const{private_key:s,cert:l,root:n}=e,r=ai.value.project_type,o={proxy:{site_name:ai.value.name,key:s,csr:l+n},default:{type:1,siteName:ai.value.name,key:s,csr:l+n}};await t({loading:"正在保存证书信息，请稍后...",request:B(o[r]||o.default,r),message:!0,success:e=>{if(!0===e.status)yi(),di("currentCertInfo");else{let t=e.msg;t="当前证书申请并验证成功，自动部署失败，请尝试手动部署证书！\n"+t,i.msg({customClass:"bt-message-error-html",dangerouslyUseHTMLString:!0,message:t,type:"error",showClose:!0,duration:0})}}})},Ri=e=>{n({title:"支付成功",area:[60,60],component:()=>r(()=>import("./pay-bus-success.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),compData:e})},ji=async({type:e,oid:a,index:s,authType:l}=Gr.value,{name:n}=ai.value)=>{if(3===e)Mi(a,e);else if(32===(null==s?void 0:s.length)&&-1===s.indexOf("/")&&"dns"!==l)Bi(s);else{const{data:e}=await t({request:ce({siteName:n,pem_file:s})});qi(e)}},Hi=async({type:e,oid:t,index:a,authType:s}=Gr.value,{name:l}=ai.value)=>{3===e?Mi(t,e):32===(null==a?void 0:a.length)&&-1===a.indexOf("/")&&"dns"!==s?Bi(a):zi(null,!0)},qi=async e=>{sr.value=e,ti.value=n({title:"续签Let's Encrypt证书",area:50,component:()=>r(()=>import("./lets-encrypt-renew.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),compData:e})},Bi=async e=>{const a=await Ei(),{data:s}=await t({request:ue({index:e})});a._props.onCancel(),Di(s,{auth_type:s.auth_type})},Mi=(e,t)=>{if(3===t)Ui(e)},Ui=async e=>{await c({title:"商业证书续签",content:"当前证书订单需要重新生成新订单，需要手动续签，和重新部署证书，是否继续操作？"});const a={pdata:JSON.stringify({oid:e})},s=await t({loading:"正在续签商业证书，可能等待时间较长，请稍后...",request:de(a),data:Object});if(o(s)&&s.hasOwnProperty("order_info")){let e=s.order_info;Fi({oid:s.oid,wxcode:s.wxcode,alicode:s.alicode,orderInfo:e,productInfo:{...e,productName:e.title,totalPrice:s.data.price,isRenew:!0}})}else i.request(s);yi()},Fi=async e=>{$r.value=e.productInfo,ei.value=e.orderInfo,Qr.value=n({title:"支付商业证书订单",area:[60],component:()=>r(()=>import("./pay-bus-ssl.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),compData:e})},Ji=async()=>{const e=si.value,a=ai.value.name,s={proxy:{site_name:a},default:{updateOf:1,siteName:a}},l=s[e]||s.default;await t({loading:"正在关闭证书，请稍后...",request:pe(l,e),message:!0,success:()=>{ni.value=!0,ci.value=!0}}),yi()},zi=async(e,t)=>{ti.value=await n({isAsync:!0,title:t?"续签Let's Encrypt证书":"申请Let's Encrypt证书",area:64,component:()=>r(()=>import("./applay-lest-ssl.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),compData:{...e,isRenew:t}})},Gi=()=>{n({component:()=>r(()=>import("./index196.js?v=1764728423"),__vite__mapDeps([]),import.meta.url),area:52,compData:{title:"SSL证书需求反馈收集",type:28,isNoRate:!0,softName:"1",isCard:!1,id:993}})};export{Ns as $,Yt as A,Zt as B,Hs as C,ms as D,ki as E,us as F,ss as G,fs as H,_s as I,rs as J,xs as K,Ja as L,hs as M,za as N,Ga as O,ns as P,Ua as Q,ys as R,Za as S,Ya as T,ws as U,Fa as V,bs as W,Xa as X,is as Y,ts as Z,Es as _,Dr as a,Is as a0,Lt as a1,Ds as a2,Ts as a3,As as a4,Cs as a5,Si as a6,xa as a7,ca as a8,va as a9,Mn as aA,Cn as aB,Bn as aC,Wn as aD,qn as aE,Jn as aF,zn as aG,jn as aH,Qn as aI,Un as aJ,cr as aK,or as aL,ir as aM,At as aN,yi as aO,Sa as aa,ua as ab,ma as ac,ka as ad,ya as ae,ga as af,wa as ag,_a as ah,ba as ai,qa as aj,Ss as ak,Qt as al,Ai as am,ar as an,tr as ao,er as ap,Ri as aq,wi as ar,rr as as,Hn as at,Fn as au,lr as av,nr as aw,sr as ax,Gn as ay,Yn as az,Nr as b,Fi as c,Or as d,ql as e,Ti as f,Lr as g,vi as h,Hl as i,ji as j,Gi as k,Ei as l,fi as m,ds as n,Pr as o,Wa as p,cs as q,Ar as r,bi as s,mi as t,xi as u,es as v,as as w,Wt as x,Qa as y,$a as z};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = []
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
