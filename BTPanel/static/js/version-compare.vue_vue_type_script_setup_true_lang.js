import{c as a,r as e,v as s,n as l,aG as r,z as t,x as n,O as i,C as u,A as o,B as v,e as c,D as m,G as p,H as d,aA as f,aZ as g}from"./base-lib.js?v=1764728423";import{hE as y,Q as b,hT as h,hU as w}from"./utils-lib.js?v=1764728423";const _={class:"text-base"},k=["innerHTML"],x=a({__name:"version-compare",setup(a){const x=e(!1),A=e(!1),M=e(!1),{version:T,cloudVersionInfo:C,getInfo:H,getCloudVersionInfo:I}=y(),V=()=>{C.value&&C.value.version&&""!==C.value.version.trim()?x.value=!((a,e)=>{const{versionArr:s,cloudVersionArr:l}=w(a,e);for(let r=0;r<s.length;r++){const a=s[r],e=l[r];if(a>e)return!0;if(a<e)return!1}return!0})(T.value,C.value.version):x.value=!1},j=()=>{b({loading:"更新中...",request:h(),message:!0,success:async()=>{await H(),await I(),V()}})};return s(async()=>{V(),await l(),setTimeout(()=>{(async()=>{if(!M.value&&!A.value){A.value=!0;try{await I(),M.value||V()}catch(a){M.value||(x.value=!1)}finally{M.value||(A.value=!1)}}})()},100)}),r(()=>{M.value=!0}),(a,e)=>{const s=d,l=f,r=g;return t(x)?(n(),i(r,{key:0,type:"warning",class:"!mb-[1.2rem] !p-[1.2rem]",closable:!1,"show-icon":""},{title:u(()=>{var a,r,d;return[o("span",_,[o("span",null," 提示：有一个新版本（"+v(null==(a=t(C))?void 0:a.version)+"）可更新，更新时间："+v(null==(r=t(C))?void 0:r.uptime),1),c(s,{class:"!ml-[1.2rem]",type:"primary",onClick:j},{default:u(()=>[...e[0]||(e[0]=[m("立即更新",-1)])]),_:1}),(null==(d=t(C))?void 0:d.updateMsg)?(n(),i(l,{key:0,placement:"bottom-start",width:"200",trigger:"hover"},{default:u(()=>{var a;return[o("div",{class:"update-details",innerHTML:null==(a=t(C))?void 0:a.updateMsg},null,8,k)]}),reference:u(()=>[...e[1]||(e[1]=[o("span",{class:"!ml-[1.2rem] bt-link text-small"},"详情",-1)])]),_:1})):p("",!0)])]}),_:1})):p("",!0)}}});export{x as _};
