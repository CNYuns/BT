!function(){function e(){/*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */var t,r,o="function"==typeof Symbol?Symbol:{},a=o.iterator||"@@iterator",u=o.toStringTag||"@@toStringTag";function c(e,o,a,u){var c=o&&o.prototype instanceof l?o:l,s=Object.create(c.prototype);return n(s,"_invoke",function(e,n,o){var a,u,c,l=0,s=o||[],f=!1,p={p:0,n:0,v:t,a:d,f:d.bind(t,4),d:function(e,n){return a=e,u=0,c=t,p.n=n,i}};function d(e,n){for(u=e,c=n,r=0;!f&&l&&!o&&r<s.length;r++){var o,a=s[r],d=p.p,v=a[2];e>3?(o=v===n)&&(c=a[(u=a[4])?5:(u=3,3)],a[4]=a[5]=t):a[0]<=d&&((o=e<2&&d<a[1])?(u=0,p.v=n,p.n=a[1]):d<v&&(o=e<3||a[0]>n||n>v)&&(a[4]=e,a[5]=n,p.n=v,u=0))}if(o||e>1)return i;throw f=!0,n}return function(o,s,v){if(l>1)throw TypeError("Generator is already running");for(f&&1===s&&d(s,v),u=s,c=v;(r=u<2?t:c)||!f;){a||(u?u<3?(u>1&&(p.n=-1),d(u,c)):p.n=c:p.v=c);try{if(l=2,a){if(u||(o="next"),r=a[o]){if(!(r=r.call(a,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,u<2&&(u=0)}else 1===u&&(r=a.return)&&r.call(a),u<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),u=1);a=t}else if((r=(f=p.n<0)?c:e.call(n,p))!==i)break}catch(r){a=t,u=1,c=r}finally{l=1}}return{value:r,done:f}}}(e,a,u),!0),s}var i={};function l(){}function s(){}function f(){}r=Object.getPrototypeOf;var p=[][a]?r(r([][a]())):(n(r={},a,function(){return this}),r),d=f.prototype=l.prototype=Object.create(p);function v(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,n(e,u,"GeneratorFunction")),e.prototype=Object.create(d),e}return s.prototype=f,n(d,"constructor",f),n(f,"constructor",s),s.displayName="GeneratorFunction",n(f,u,"GeneratorFunction"),n(d),n(d,u,"Generator"),n(d,a,function(){return this}),n(d,"toString",function(){return"[object Generator]"}),(e=function(){return{w:c,m:v}})()}function n(e,t,r,o){var a=Object.defineProperty;try{a({},"",{})}catch(e){a=0}n=function(e,t,r,o){function u(t,r){n(e,t,function(e){return this._invoke(t,r,e)})}t?a?a(e,t,{value:r,enumerable:!o,configurable:!o,writable:!o}):e[t]=r:(u("next",0),u("throw",1),u("return",2))},n(e,t,r,o)}function t(e,n,t,r,o,a,u){try{var c=e[a](u),i=c.value}catch(e){return void t(e)}c.done?n(i):Promise.resolve(i).then(r,o)}function r(e){return function(){var n=this,r=arguments;return new Promise(function(o,a){var u=e.apply(n,r);function c(e){t(u,o,a,c,i,"next",e)}function i(e){t(u,o,a,c,i,"throw",e)}c(void 0)})}}System.register(["./utils-lib-legacy.js?v=1764656280","./index-legacy111.js?v=1764656280","./base-lib-legacy.js?v=1764656280","./form-item-legacy.js?v=1764656280","./site-legacy.js?v=1764656280","./useStore-legacy4.js?v=1764656280","./useController-legacy5.js?v=1764656280","./__commonjsHelpers__-legacy.js?v=1764656280","./column-legacy.js?v=1764656280","./useController-legacy6.js?v=1764656280","./validator-legacy.js?v=1764656280","./index-legacy108.js?v=1764656280","./useMethod-legacy5.js?v=1764656280"],function(n,t){"use strict";var o,a,u,c,i,l,s,f,p,d,v,h,b,m,y,g,_,k,w,x,j,O,C,S,G,W,q,P,T,V,A,B,F,L,U,E;return{setters:[function(e){o=e.L,a=e.M,u=e.Q,c=e.B,i=e.p,l=e.ax,s=e.d,f=e.N,p=e.k,d=e._},function(e){v=e._},function(e){h=e.c,b=e.r,m=e.g,y=e.v,g=e.I,_=e.J,k=e.z,w=e.x,x=e.y,j=e.e,O=e.C,C=e.O,S=e.A,G=e.G,W=e.B,q=e.n,P=e.ad},function(e){T=e.g},function(e){V=e.updateGitmanagerSite,A=e.getBranchList,B=e.refreshWebhook,F=e.getGitmanager},function(e){L=e.u},function(e){U=e.w,E=e.x},null,null,null,null,null,null],execute:function(){var t={class:"overflow-auto max-h-63rem"},I={class:"flex flex-col pt-5px w-40rem leading-22px"},H={class:"flex flex-col pt-5px w-40rem leading-22px"},M={class:"flex items-center custom-refresh-select"},N={class:"el-input-group__append !h-3rem !flex items-center"},R={class:"flex flex-col gap-8px w-40rem leading-22px"},z=h({__name:"index",setup:function(n,d){var h,z=d.expose,J=L().siteInfo,K=b(!1),Q=b([]),D=b(!1),X=function(){var n=r(e().m(function n(t){return e().w(function(e){for(;;)if(0===e.n)return e.a(2,U(t,Z))},n)}));return function(e){return n.apply(this,arguments)}}(),Y=function(){var n=r(e().m(function n(){var t,r=arguments;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=r.length>0&&void 0!==r[0]&&r[0],e.p=1,oe.value.repo){e.n=2;break}return a.error("请先填写仓库地址"),e.a(2);case 2:u({request:A({repo:oe.value.repo,force:t?1:0}),data:{data:[Array,function(e){return e.map(function(e){return{label:e,value:e}})}]},success:function(e){Q.value=Array.isArray(e.data)?e.data:[],t&&a.success("分支列表已刷新")}}),e.n=4;break;case 3:e.p=3,e.v;case 4:return e.a(2)}},n,null,[[1,3]])}));return function(){return n.apply(this,arguments)}}(),Z=function(){var n=r(e().m(function n(){var t;return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,E();case 1:t=e.v,oe.value.ssh_key=t.ssh_key.msg,D.value=t.webhook_install,e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},n,null,[[0,2]])}));return function(){return n.apply(this,arguments)}}(),$=function(){var n=r(e().m(function n(){return e().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,i({title:"重置令牌",content:"重置后旧链接将失效，Webhook 日志将被清空，且需要重新选择脚本。是否继续？ URL将失效。"});case 1:u({loading:"正在重置Webhook令牌，请稍后...",request:B({git_manager_id:J.value.git_manager.id}),success:function(e){e.data.data.webhook_url&&(oe.value.webhook_url=e.data.data.webhook_url),a.request({status:e.data.status,msg:e.data.status?"重置成功":"重置失败"})}});case 2:return e.a(2)}},n)}));return function(){return n.apply(this,arguments)}}(),ee=function(){var n=r(e().m(function n(){return e().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,u({loading:K,request:F({git_manager_id:J.value.git_manager.id}),data:{data:Object},success:function(e){Object.assign(oe.value,{repo:e.repo_url,branch:e.branch,deploy_script:e.deploy_script,webhook_url:e.webhook_url})}});case 1:e.n=3;break;case 2:e.p=2,e.v;case 3:return e.a(2)}},n,null,[[0,2]])}));return function(){return n.apply(this,arguments)}}(),ne=o({data:function(){return{}},options:function(){return m(function(){return[{type:"slots",key:"gitconf",rules:{branch:[{required:!0,message:"请选择分支",trigger:["change","blur"]}]}},T("保存",{attrs:{class:"!ml-[12rem]",type:"primary",onClick:re}})]})},submit:(h=r(e().m(function n(t,r,o){var c,i,l,s;return e().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,r();case 1:if(D.value){e.n=2;break}return a.error("Webhook 未安装，无法保存配置"),e.a(2);case 2:return c=t.value,i=c.branch,l=c.deploy_script,e.n=3,u({loading:"正在设置仓库配置，请稍后...",request:V({git_manager_id:J.value.git_manager.id,branch:i,deploy_script:l}),message:!0,success:function(e){}});case 3:return s=e.v,e.a(2,s.status)}},n)})),function(e,n,t){return h.apply(this,arguments)})}),te=ne.BtForm,re=ne.submit,oe=ne.param,ae=function(){var n=r(e().m(function n(){return e().w(function(n){for(;;)switch(n.n){case 0:q(r(e().m(function n(){return e().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,ee();case 1:Y(),Z();case 2:return e.a(2)}},n)})));case 1:return n.a(2)}},n)}));return function(){return n.apply(this,arguments)}}();return y(ae),z({init:ae}),function(e,n){var r=P,o=v,a=l,u=s,i=f,d=p,h=g("bt-loading");return _((w(),x("div",t,[j(k(te),{"label-width":"10rem"},{gitconf:O(function(){return[k(D)?G("",!0):(w(),C(r,{key:0,label:"Webhook"},{default:O(function(){return[S("span",{class:"bt-danger text-small",onClick:n[0]||(n[0]=function(e){return X("webhook")})}," 未安装Webhook，点击安装 ")]}),_:1})),j(r,{label:"SSH Key",prop:"ssh_key",class:"!mb-1rem"},{default:O(function(){return[S("div",I,[S("div",{onClick:n[1]||(n[1]=function(e){return k(c)({value:k(oe).ssh_key})})},W(k(oe).ssh_key),1),S("div",null,[S("span",{class:"bt-link",onClick:n[2]||(n[2]=function(e){return k(c)({value:k(oe).ssh_key})})},"复制")])])]}),_:1}),j(r,{label:"仓库",prop:"repo",class:"!mb-1rem"},{default:O(function(){return[S("div",{onClick:n[3]||(n[3]=function(e){return k(c)({value:k(oe).repo})})},W(k(oe).repo),1)]}),_:1}),j(r,{label:"Webhook URL",class:"!mb-1rem"},{default:O(function(){return[S("div",H,[S("div",{onClick:n[4]||(n[4]=function(e){return k(c)({value:k(oe).webhook_url})})},W(k(oe).webhook_url),1),S("div",null,[S("span",{class:"bt-link",onClick:n[5]||(n[5]=function(e){return k(c)({value:k(oe).webhook_url})})},"复制"),j(o),S("span",{class:"bt-link",onClick:$},"重置令牌")])])]}),_:1}),j(r,{label:"分支",prop:"branch"},{default:O(function(){return[S("div",M,[j(a,{modelValue:k(oe).branch,"onUpdate:modelValue":n[6]||(n[6]=function(e){return k(oe).branch=e}),options:k(Q),class:"!w-[30rem]",placeholder:"请选择分支"},null,8,["modelValue","options"]),S("div",N,[j(i,{title:"刷新分支",class:"!flex",onClick:n[7]||(n[7]=function(e){return Y(!0)})},{default:O(function(){return[j(u,{icon:"el-refresh",class:"!text-base"})]}),_:1})])])]}),_:1}),j(r,{label:"部署脚本",prop:"deploy_script"},{default:O(function(){return[S("div",R,[j(d,{type:"textarea",rows:10,class:"!w-40rem",placeholder:"请输入部署脚本",modelValue:k(oe).deploy_script,"onUpdate:modelValue":n[8]||(n[8]=function(e){return k(oe).deploy_script=e})},null,8,["modelValue"]),n[9]||(n[9]=S("div",{class:"text-small"},"* 脚本将会在获取最新代码（git pull）后执行",-1))])]}),_:1})]}),_:1})])),[[h,k(K)]])}}});n("default",d(z,[["__scopeId","data-v-31894326"]]))}}})}();
