import{u as a,hA as t,V as s,n as e,p as l,M as o,aC as n,$ as r}from"./utils-lib.js?v=1764728423";import{c as u,g as i,v as c,I as p,x as m,y as d,z as v,O as y,R as f,G as h,A as w,J as g,e as b,C as j,D as C,H as x,b2 as V}from"./base-lib.js?v=1764728423";import{d6 as k}from"./validator.js?v=1764728423";import{d as _,c as F,t as S,a as H,b as q,e as E,h as U,g as A,f as B,j as I}from"./useController19.js?v=1764728423";import{B as N}from"./index119.js?v=1764728423";import{u as O,S as z}from"./useStore4.js?v=1764728423";import{S as D}from"./useStore14.js?v=1764728423";import"./__commonjsHelpers__.js?v=1764728423";import"./index110.js?v=1764728423";import"./column.js?v=1764728423";import"./index107.js?v=1764728423";import"./ace.js?v=1764728423";import"./site.js?v=1764728423";const G={class:"h-full"},J={class:"w-full"},M={class:"my-[12px]"},R=u({__name:"file",setup(u){const{viewFileHistoryEvent:R,recoverFileEvent:T}=D(),{siteInfo:$}=O(),{plugin:K}=a(),{saveFileEvent:L}=z(),P=()=>{const{BtTable:a}=t({request:()=>({data:U.value,total:U.value.length}),columns:[{label:"文件名",render:a=>s(Number(a))},{label:"操作",align:"right",render:a=>{let t=Number(a);return b("div",null,[b("span",{class:"cursor-pointer bt-link",onClick:()=>{W(a)}},[C("查看")]),b(V,{direction:"vertical"},null),b("span",{class:"cursor-pointer bt-link",onClick:()=>{Q(t)}},[C("恢复")])])}}]});e({title:"配置文件历史版本",area:42,showFooter:!0,component:()=>b("div",{class:"p-[20px]"},[b(a,null,null)])})},Q=async a=>{try{await l({title:"恢复历史文件",content:"是否恢复历史文件 ".concat(s(a))});const t=await T({row:a,path:X.value});return o.request({status:t.status,msg:t.status?"恢复成功":"恢复失败"}),t.status&&A({path:X.value}),t.status}catch(t){}},W=async a=>{await(async a=>{try{const t=await R({row:a,path:X.value});return B.value=t.status?t.data:"文件不存在",t}catch(t){return{status:!1,msg:"获取文件历史失败"}}})(a),e({title:"查看文件历史版本",area:64,showFooter:!1,component:()=>b("div",{class:"p-[20px]"},[b(x,{type:"primary",onClick:()=>Q(a)},{default:()=>[C("恢复文件")]}),b(N,{class:"!h-[54rem] !w-full my-[12px]",modelValue:B.value,"onUpdate:modelValue":a=>B.value=a,editorOption:k({readonly:!0})},null)])})},X=i(()=>{const a="/www/server/panel/vhost/".concat(K.value.webserver,"/").concat($.value.name,".conf");return"config"===_.value?a.replace(/\/+/g,"/"):F.value}),Y=async(a={data:E.value,encoding:"utf-8",path:X.value})=>{try{(await L(a)).status&&A({path:a.path})}catch(t){return{status:!1,msg:"保存文件失败"}}};return c(async()=>{I(),await A({path:X.value})}),(a,t)=>{const s=n,e=r,l=p("bt-loading");return m(),d("div",G,[v(F)?(m(),y(s,{key:0,type:"card",modelValue:v(_),"onUpdate:modelValue":t[0]||(t[0]=a=>f(_)?_.value=a:null),options:v(S),onChange:v(H)},null,8,["modelValue","options","onChange"])):h("",!0),w("div",J,[t[6]||(t[6]=w("span",{class:"my-[4px] text-secondary"},"提示：Ctrl+F 搜索关键字，Ctrl+S 保存，Ctrl+H 查找替换",-1)),w("div",M,[g(b(v(N),{class:"!h-[54rem] rounded-base",modelValue:v(E),"onUpdate:modelValue":t[1]||(t[1]=a=>f(E)?E.value=a:null),request:!1,onSave:t[2]||(t[2]=a=>Y()),id:"configContent"},null,8,["modelValue"]),[[l,v(q)]])]),w("div",null,[b(v(x),{type:"primary",onClick:t[3]||(t[3]=a=>Y())},{default:j(()=>[...t[4]||(t[4]=[C("保存",-1)])]),_:1}),b(v(x),{onClick:P,type:"default"},{default:j(()=>[...t[5]||(t[5]=[C("历史文件",-1)])]),_:1})]),b(e,{options:[{content:"此处为站点主配置文件，若您不了解配置规则，请勿随意修改."}],"list-style":"none",class:"ml-[20px] mt-[20px]"})])])}}});export{R as default};
