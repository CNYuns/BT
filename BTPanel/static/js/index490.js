import{_ as e}from"./index109.js?v=1764728423";import{p as a,Q as t,b8 as s,hq as n,cQ as l,d as o,l as c,ah as i,j as r,ay as u,iV as p,b as m}from"./utils-lib.js?v=1764728423";import{B as d}from"./index119.js?v=1764728423";import{c as f,r as h,o as v,v as g,x as y,y as b,A as x,z as _,e as w,G as C,O as k,D as j,B as q,C as I,R as V,H as E,b2 as T}from"./base-lib.js?v=1764728423";import{a as F,u as z,c as A}from"./column.js?v=1764728423";import"./__commonjsHelpers__.js?v=1764728423";import"./ace.js?v=1764728423";import"./index110.js?v=1764728423";const D={class:"p-[2rem]"},O={class:"title-box flex items-center justify-between"},B={class:"flex items-center"},H={key:0,class:"scan-icon relative h-[8rem] w-[8rem]"},Q={class:"scan-title flex flex-col items-start ml-[2rem]"},U={class:"font-bold text-large text-default"},G={class:"text-danger"},J={class:"text-small text-secondary mt-[1.2rem]"},M={class:"flex items-center ml-[1.2rem]"},N={class:"p-[2rem]"},R=f({__name:"index",props:{compData:{default:()=>{}}},setup(f){const R=f,S=m(),K=h("loading"),L=h(!1),P=h("");let W={},X=null;const Y=v({scanInfo:"",scanCount:0,scanningCount:0,scanningText:"进行中"}),Z=h(),$=h([]),ee=[{label:"删除",value:"delete",event:async(e,a,t,s)=>{const{label:n,value:l}=s,o=async(e,a)=>{const{path:t}=e;if("delete"===l){const e=await p({path:t,type:"File"});return e.status&&($.value=$.value.filter(e=>e.path!==t)),e}};await e({title:"批量".concat(n,"文件"),content:"批量".concat(n,"已选的文件，是否继续操作！"),column:[{label:"文件名",prop:"name"},A()],onConfirm:async()=>(await a(o),!1)})}}],ae=(e,a)=>{if("token error"===a.data)return S.error("token error"),void(null==X||X.close());const t=JSON.parse(a.data);Y.scanInfo=t.info,t.is_count&&(Y.scanCount=t.count,Y.scanningCount=t.is_count),t.path&&$.value.push({path:t.path,name:t.path.substring(t.path.lastIndexOf("/")+1)}),t.result&&(K.value="success",Y.scanningText="已完成",Y.scanInfo="扫描已完成",Y.scanningCount=Y.scanCount,t.result.length>0&&(K.value="danger"),null==X||X.close())},te=async()=>{$.value=[],X=u({route:"/ws_panel",onMessage:ae}),K.value="loading",Y.scanningText="进行中",null==X||X.send({def_name:"ws_webshell_check",mod_name:"files",path:R.compData.row.path,ws_callback:"1"})},se=async()=>{await a({title:"提示",content:"查杀正在进行中，确定要停止扫描吗？",icon:"question-filled"}),Y.scanningText="已取消",K.value="success",null==X||X.close()},ne=async()=>{t({request:s({path:W.path,data:P.value,encoding:"utf-8"}),message:!0})},le=(({openFileEvent:e,falseAlarmEvent:a,deleteEvent:t})=>[F(),{label:"文件名",prop:"name",width:160},{label:"文件路径",prop:"path"},z([{onClick:a,title:"误报"},{onClick:e,title:"打开文件",width:70},{onClick:t,title:"删除"}])])({openFileEvent:async e=>{t({request:n({path:e.path}),success:a=>{P.value=a.data.data,L.value=!0,W=e}})},falseAlarmEvent:async e=>{try{await a({title:"提示",content:"是否确定提交误报反馈",icon:"question-filled",type:"calc"}),t({request:l({filename:e.path}),message:!0,success:()=>{$.value=$.value.filter(a=>a.path!==e.path)}})}catch(s){}},deleteEvent:async(e,s=!1)=>{try{await a({title:"提示",content:"确定删除文件【"+e.path+"】?删除后文件将移至回收站，是否继续操作?",icon:"question-filled",type:"calc"}),t({request:p({path:e.path,type:"File"}),message:!0,success:a=>{a.status&&($.value=$.value.filter(a=>a.path!==e.path))}})}catch(n){}}});return g(()=>{te()}),(a,t)=>{const s=o,n=E,l=T,u=c,p=i,m=d,f=r,h=e;return y(),b("div",D,[x("div",O,[x("div",B,["loading"==_(K)?(y(),b("div",H,[t[3]||(t[3]=x("div",{class:"animate-spin absolute top-0 border-primary border-b-2 rounded-full h-full w-full"},null,-1)),w(s,{icon:"scanning-scan",size:60,color:"var(--el-color-primary)",class:"absolute top-0 left-0 right-0 bottom-0 m-[auto] h-[8rem] w-[6rem]"})])):C("",!0),"success"==_(K)?(y(),k(s,{key:1,icon:"scanning-success",size:60,color:"var(--el-color-primary)"})):C("",!0),"danger"==_(K)?(y(),k(s,{key:2,icon:"scanning-danger",size:60,color:"var(--el-color-danger)"})):C("",!0),x("div",Q,[x("span",U,[j(" 查杀"+q(_(Y).scanningText)+" ，已扫描文件 "+q(_(Y).scanningCount)+" /"+q(_(Y).scanCount)+" 个；发现木马文件 ",1),x("span",G,q(_($).length),1),t[4]||(t[4]=j(" 个 ",-1))]),x("span",J,q(_(Y).scanInfo.length>70?"..."+_(Y).scanInfo.substring(_(Y).scanInfo.length-70):_(Y).scanInfo),1)])]),x("div",M,["loading"===_(K)?(y(),k(n,{key:0,type:"default",onClick:se},{default:I(()=>[...t[5]||(t[5]=[j(" 取消 ",-1)])]),_:1})):C("",!0),"loading"!=_(K)?(y(),k(n,{key:1,type:"primary",onClick:t[0]||(t[0]=e=>te())},{default:I(()=>[...t[6]||(t[6]=[j(" 重新查杀 ",-1)])]),_:1})):C("",!0)])]),w(l),w(h,null,{content:I(()=>[w(u,{ref_key:"safeTable",ref:Z,column:_(le),data:_($)},null,8,["column","data"])]),"footer-left":I(()=>[w(p,{"table-ref":_(Z),options:ee},null,8,["table-ref"])]),popup:I(()=>[w(f,{title:"在线编辑",showFooter:"",modelValue:_(L),"onUpdate:modelValue":t[2]||(t[2]=e=>V(L)?L.value=e:null),area:70,onConfirm:ne},{default:I(()=>[x("div",N,[w(m,{modelValue:_(P),"onUpdate:modelValue":t[1]||(t[1]=e=>V(P)?P.value=e:null),class:"!h-[40rem]"},null,8,["modelValue"])])]),_:1},8,["modelValue"])]),_:1})])}}});export{R as default};
